var Ue=Object.defineProperty;var Me=(r,s,t)=>s in r?Ue(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var V=(r,s,t)=>Me(r,typeof s!="symbol"?s+"":s,t);import{j as e}from"./radixUI-MBKqlelr.js";import{a as y,j as Be}from"./vendor-BQUE8CnD.js";import{C as Y,b as Q,c as ee,a as Z}from"./card-0UsC1Hfx.js";import{s as oe,A as Re,u as qe,S as He,a as Fe,V as Je}from"./form-section-CIywKYlm.js";import{d as Se,A as ce,T as ke,j as We,b as de,B as se,e as je,S as Te,L as Ne,X as Ve}from"./index-BX3Jf5rY.js";import{R as me}from"./refresh-cw-FCIZnuDU.js";import{C as we,I as Ge}from"./info-CS099tTK.js";import{C as Xe}from"./check-CrQWtsni.js";import{s as Ke,B as Ie,C as ue,p as _e,u as Ye,S as Ze,I as Qe,a as et,P as tt,R as st,i as at,U as rt,F as nt,D as it,H as ot,W as lt,T as ct,b as dt,c as mt,d as ut,e as pt,f as ht,J as xt,g as gt,h as ft}from"./FinalReviewStep-CraeGDKJ.js";import{P as Ae}from"./progress-CxTYqs7F.js";import{C as St}from"./clock-DuORzYmm.js";import{C as te}from"./circle-check-big-D7qwqCjm.js";import{a as yt}from"./checkbox-CzwSq1oz.js";import{S as bt}from"./save-CkQaEi9A.js";import{C as Nt}from"./chevron-right-D20CZ_0W.js";import{B as vt,c as jt}from"./breadcrumb-LLTWqxPN.js";import{T as wt,a as Ct,b as Dt,c as xe}from"./tabs-CTtBr4tg.js";import{R as Ft,a as ve}from"./formValidation-odEsOSDa.js";import{L as Tt}from"./label-BGHhm9HA.js";import{I as _t}from"./input-C7n7UaRv.js";import{a as fe}from"./utils-Co3JUx4V.js";import{C as Ee,a as kt}from"./graduation-cap-C7kQc0Ju.js";import{F as Ce}from"./file-text-lgpzM1Mh.js";import{B as It}from"./building-2-Ckg-FmN9.js";import{P as At}from"./PDFButton-lxgnBNdF.js";import"./select-CHEqtOpE.js";import"./chevron-down-BIP_RoMW.js";import"./user-BSKbQLbH.js";import"./map-pin-DbAZafho.js";import"./mail-BXPjmS9p.js";import"./phone-CsbprQIk.js";import"./badge-DbL2e8Dt.js";import"./building-D7pk8e3U.js";import"./calendar-D-I7OBt9.js";import"./arrow-right-D1e7oZqi.js";import"./eye-6Y9sbcRx.js";import"./users-DJfJLhR6.js";import"./download-DxzIzwbA.js";import"./plus-_zwNWoy_.js";import"./trash-2-CRAWfZhR.js";import"./separator-BW__RCi5.js";import"./rotate-ccw-BXdVcjfo.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=Se("CloudOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Se("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=Se("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=Se("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);class Lt extends y.Component{constructor(){super(...arguments);V(this,"state",{hasError:!1,error:null,errorInfo:null});V(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})})}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null}}componentDidCatch(t,n){this.setState({error:t,errorInfo:n})}render(){return this.state.hasError?this.props.fallback?e.jsx(e.Fragment,{children:this.props.fallback}):e.jsx("div",{className:"min-h-[400px] flex items-center justify-center p-8",children:e.jsxs(ce,{className:"max-w-2xl border-red-200 bg-red-50",children:[e.jsx(ke,{className:"h-5 w-5 text-red-600"}),e.jsx(We,{className:"text-red-900",children:"Something went wrong"}),e.jsxs(de,{className:"mt-2 text-red-800",children:[e.jsx("p",{className:"mb-4",children:"We encountered an unexpected error. This has been logged and we'll look into it."}),!1,e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(se,{onClick:this.handleReset,variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Try Again"]}),e.jsx(se,{onClick:()=>window.location.href="/",variant:"outline",size:"sm",children:"Go to Home"})]})]})]})}):this.props.children}}function $t({status:r,lastSyncTime:s,error:t,className:n,showDetails:d=!0}){const x=()=>{switch(r){case"synced":return e.jsx(Xe,{className:"h-4 w-4"});case"syncing":return e.jsx(me,{className:"h-4 w-4 animate-spin"});case"error":return e.jsx(we,{className:"h-4 w-4"});case"offline":return e.jsx(Pe,{className:"h-4 w-4"})}},o=()=>{switch(r){case"synced":return"text-green-600";case"syncing":return"text-blue-600";case"error":return"text-red-600";case"offline":return"text-gray-500"}},S=()=>{switch(r){case"synced":return"Synced to cloud";case"syncing":return"Syncing...";case"error":return"Sync error";case"offline":return"Offline - saved locally"}},v=()=>{if(!s)return null;const g=new Date().getTime()-s.getTime(),j=Math.floor(g/1e3),w=Math.floor(j/60),U=Math.floor(w/60);return j<60?"Just now":w<60?`${w}m ago`:U<24?`${U}h ago`:s.toLocaleDateString()};return e.jsxs("div",{className:je("flex items-center space-x-2",n),children:[e.jsxs("div",{className:je("flex items-center space-x-1",o()),children:[r==="synced"?e.jsx(Le,{className:"h-4 w-4"}):x(),d&&e.jsx("span",{className:"text-sm font-medium",children:S()})]}),d&&s&&r==="synced"&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",v(),")"]}),d&&t&&r==="error"&&e.jsxs("span",{className:"text-xs text-red-600",title:t,children:["- ",t.length>30?t.substring(0,30)+"...":t]})]})}function zt({status:r,className:s}){const t=()=>{switch(r){case"synced":return"bg-green-100";case"syncing":return"bg-blue-100";case"error":return"bg-red-100";case"offline":return"bg-gray-100"}},n=()=>{switch(r){case"synced":return"text-green-600";case"syncing":return"text-blue-600";case"error":return"text-red-600";case"offline":return"text-gray-600"}};return e.jsx("div",{className:je("inline-flex items-center justify-center rounded-full p-1",t(),s),children:e.jsx("div",{className:n(),children:r==="synced"?e.jsx(Le,{className:"h-3 w-3"}):r==="syncing"?e.jsx(me,{className:"h-3 w-3 animate-spin"}):r==="error"?e.jsx(we,{className:"h-3 w-3"}):e.jsx(Pe,{className:"h-3 w-3"})})})}function Ot(r={}){const{onlineCheckUrl:s="/api/healthz",onlineCheckInterval:t=3e4}=r,[n,d]=y.useState("synced"),[x,o]=y.useState(),[S,v]=y.useState(),[h,g]=y.useState(navigator.onLine);y.useEffect(()=>{const $=()=>{g(!0),n==="offline"&&(d("synced"),v(void 0))},f=()=>{g(!1),d("offline")};return window.addEventListener("online",$),window.addEventListener("offline",f),()=>{window.removeEventListener("online",$),window.removeEventListener("offline",f)}},[n]),y.useEffect(()=>{if(!h)return;const $=new AbortController;let f;const C=async()=>{try{f=setTimeout(()=>$.abort(),5e3);const A=await fetch(s,{method:"GET",signal:$.signal});if(f&&clearTimeout(f),!A.ok)throw new Error(`Server responded with ${A.status}`);g(!0),n==="offline"&&(d("synced"),v(void 0))}catch(A){if(f&&clearTimeout(f),(A==null?void 0:A.name)==="AbortError")return;console.warn("Online check failed:",A)}};C();const D=setInterval(C,t);return()=>{$.abort(),f&&clearTimeout(f),clearInterval(D)}},[s,t,h,n]);const j=y.useCallback(()=>{if(!h){d("offline");return}d("syncing"),v(void 0)},[h]),w=y.useCallback(()=>{d("synced"),o(new Date),v(void 0)},[]),U=y.useCallback($=>{d("error"),v($)},[]),c=y.useCallback(()=>{d("offline"),v(void 0)},[]);return{syncStatus:n,lastSyncTime:x,syncError:S,isOnline:h,startSync:j,syncSuccess:w,reportSyncError:U,syncOffline:c}}class Ut{constructor(s={}){V(this,"intervals",{});V(this,"formStates",{});V(this,"config");this.config={interval:6e4,debounceDelay:2e3,...s}}initAutoSave(s,t,n){this.clearAutoSave(s),this.formStates[s]={lastData:null,lastSaved:null,saving:!1,error:null},this.intervals[s]=setInterval(async()=>{await this.performAutoSave(s,t,n)},this.config.interval),console.log(`Auto-save initialized for ${s} with ${this.config.interval/1e3}s interval`)}async performAutoSave(s,t,n){const d=this.formStates[s];if(!(!d||d.saving))try{const x=t();if(!x||this.isDataEqual(d.lastData,x))return;d.saving=!0,d.error=null,await n(s,x),d.lastData=typeof structuredClone<"u"?structuredClone(x):JSON.parse(JSON.stringify(x)),d.lastSaved=new Date,d.saving=!1,console.log(`Auto-saved ${s} at ${d.lastSaved.toISOString()}`)}catch(x){console.error(`Auto-save failed for ${s}:`,x),d.saving=!1,d.error=x instanceof Error?x.message:"Auto-save failed"}}triggerImmediateSave(s,t,n){const d=this.formStates[s];d&&(d.debounceTimer&&clearTimeout(d.debounceTimer),d.debounceTimer=setTimeout(async()=>{await this.performAutoSave(s,t,n)},this.config.debounceDelay))}clearAutoSave(s){this.intervals[s]&&(clearInterval(this.intervals[s]),delete this.intervals[s]);const t=this.formStates[s];t!=null&&t.debounceTimer&&clearTimeout(t.debounceTimer),delete this.formStates[s],console.log(`Auto-save cleared for ${s}`)}getSaveStatus(s){var o;if(s&&this.formStates[s]){const S=this.formStates[s];return{lastSaved:S.lastSaved,saving:S.saving,error:S.error}}const t=Object.values(this.formStates),n=t.some(S=>S.saving),d=t.reduce((S,v)=>v.lastSaved&&(!S||v.lastSaved>S)?v.lastSaved:S,null),x=((o=t.find(S=>S.error))==null?void 0:o.error)||null;return{lastSaved:d,saving:n,error:x}}isDataEqual(s,t){if(s===t)return!0;if(!s||!t||typeof s!="object"||typeof t!="object")return!1;const n=Object.keys(s),d=Object.keys(t);return n.length!==d.length?!1:JSON.stringify(s)===JSON.stringify(t)}updateLastSaved(s,t){const n=this.formStates[s];n&&(n.lastSaved=new Date,t&&(n.lastData=typeof structuredClone<"u"?structuredClone(t):JSON.parse(JSON.stringify(t))),n.error=null)}setError(s,t){const n=this.formStates[s];n&&(n.error=t,n.saving=!1)}hasUnsavedChanges(){return Object.values(this.formStates).some(s=>s.lastData&&!s.lastSaved)}getActiveFormIds(){return Object.keys(this.intervals)}destroy(){Object.keys(this.intervals).forEach(s=>{this.clearAutoSave(s)}),console.log("AutoSaveManager destroyed")}}class Mt{constructor(){V(this,"session",null);V(this,"autoSaveManager");V(this,"currentStepIndex",0);V(this,"stepData",{});V(this,"stepErrors",{});V(this,"steps",[{id:"welcome",name:"Welcome",order:1,required:!0,estimatedMinutes:2,governmentRequired:!1},{id:"personal-info",name:"Personal Information",order:2,required:!0,estimatedMinutes:8,governmentRequired:!1},{id:"job-details",name:"Job Details Confirmation",order:3,required:!0,estimatedMinutes:3,governmentRequired:!1},{id:"company-policies",name:"Company Policies",order:4,required:!0,estimatedMinutes:10,governmentRequired:!1},{id:"i9-complete",name:"I-9 Employment Verification",order:5,required:!0,estimatedMinutes:20,governmentRequired:!0},{id:"w4-form",name:"W-4 Tax Form",order:6,required:!0,estimatedMinutes:10,governmentRequired:!0},{id:"direct-deposit",name:"Direct Deposit",order:7,required:!0,estimatedMinutes:5,governmentRequired:!1},{id:"trafficking-awareness",name:"Human Trafficking Awareness",order:8,required:!0,estimatedMinutes:5,governmentRequired:!0},{id:"weapons-policy",name:"Weapons Policy",order:9,required:!0,estimatedMinutes:2,governmentRequired:!1},{id:"health-insurance",name:"Health Insurance",order:10,required:!0,estimatedMinutes:8,governmentRequired:!1},{id:"final-review",name:"Final Review",order:11,required:!0,estimatedMinutes:5,governmentRequired:!1}]);V(this,"apiUrl");this.autoSaveManager=new Ut,this.apiUrl=""}async initializeOnboarding(s){try{if(s==="demo-token"){const t={employee:{id:"demo-employee-001",firstName:"John",lastName:"Doe",email:"john.doe@demo.com",position:"Front Desk Associate",department:"Front Office",startDate:"2025-02-01",propertyId:"demo-property-001",payRate:18.5,payFrequency:"hourly",startTime:"9:00 AM",benefitsEligible:"yes",supervisor:"Jane Manager",specialInstructions:"Please report to the front desk on your first day."},property:{id:"demo-property-001",name:"Demo Hotel & Suites",address:"123 Demo Street, Demo City, DC 12345"},progress:{currentStepIndex:0,totalSteps:this.steps.length,completedSteps:[],percentComplete:0,canProceed:!0},sessionToken:s,expiresAt:new Date(Date.now()+864e5),savedFormData:{}};return this.session=t,this.currentStepIndex=0,this.session}try{const t=await fetch(`${this.apiUrl}/api/onboarding/welcome/${s}`);if(!t.ok)throw new Error(`API responded with status: ${t.status}`);const n=await t.json(),d=n.data||n;return this.session={employee:d.employee,property:d.property,progress:{...d.progress,canProceed:!0},sessionToken:s,expiresAt:new Date(d.expiresAt),savedFormData:d.savedFormData||{}},this.currentStepIndex=this.session.progress.currentStepIndex||0,this.session}catch(t){throw console.error("API call failed:",t),t}}catch(t){throw console.error("Failed to initialize onboarding session:",t),t}}getProgress(){if(!this.session)throw new Error("Session not initialized");const s=this.session.progress.completedSteps||[],t=this.steps.length,n=Math.round(s.length/t*100);return{currentStepIndex:this.currentStepIndex,totalSteps:t,completedSteps:s,percentComplete:n,canProceed:this.canProceedToNextStep()}}async markStepComplete(s,t){if(!this.session)throw new Error("Session not initialized");try{t&&await this.saveProgress(s,t),this.session.progress.completedSteps.includes(s)||this.session.progress.completedSteps.push(s);const n=`onboarding_${s}_completed`;if(sessionStorage.setItem(n,"true"),sessionStorage.setItem("onboarding_progress",JSON.stringify(this.session.progress)),this.session.employee.id==="demo-employee-001"||this.session.sessionToken==="demo-token"){console.log(`Demo mode: Marked step ${s} as complete`);return}if(!(await fetch(`${this.apiUrl}/api/onboarding/${this.session.employee.id}/complete/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.session.sessionToken}`},body:JSON.stringify(t||{})})).ok)throw new Error("Failed to mark step complete in cloud");console.log(`Step marked as complete in cloud: ${s}`);return}catch(n){console.error("Failed to mark step complete in cloud, saved locally:",n);return}}async saveProgress(s,t){if(!this.session)throw new Error("Session not initialized");try{t&&this.setStepData(s,t);const n=`onboarding_${s}_data`;if(t&&sessionStorage.setItem(n,JSON.stringify(t)),this.session.employee.id==="demo-employee-001"||this.session.sessionToken==="demo-token"){console.log(`Demo mode: Saved progress for step ${s}`,t);return}if(!(await fetch(`${this.apiUrl}/api/onboarding/${this.session.employee.id}/progress/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.session.sessionToken}`},body:JSON.stringify(t||{})})).ok)throw new Error("Failed to save progress to cloud");console.log(`Progress saved to cloud for step: ${s}`);return}catch(n){console.error("Failed to save progress to cloud, saved locally:",n);return}}goToNextStep(){this.canProceedToNextStep()&&(this.currentStepIndex=Math.min(this.currentStepIndex+1,this.steps.length-1))}goToPreviousStep(){this.currentStepIndex=Math.max(this.currentStepIndex-1,0)}goToStep(s){s>=0&&s<this.steps.length&&(this.currentStepIndex=s)}getCurrentStep(){return this.steps[this.currentStepIndex]}canProceedToNextStep(){if(!this.session)return!1;const s=this.getCurrentStep();return this.session.progress.completedSteps.includes(s.id)||!s.required}getStepProps(){if(!this.session)throw new Error("Session not initialized");const s=this.getCurrentStep(),t=this.getProgress();return{currentStep:{id:s.id,name:s.name,order:s.order,required:s.required},progress:{completedSteps:t.completedSteps,currentStepIndex:this.currentStepIndex,totalSteps:this.steps.length,percentComplete:t.percentComplete},markStepComplete:this.markStepComplete.bind(this),saveProgress:this.saveProgress.bind(this),goToNextStep:this.goToNextStep.bind(this),goToPreviousStep:this.goToPreviousStep.bind(this),language:"en",employee:this.session.employee,property:this.session.property,sessionToken:this.session.sessionToken,expiresAt:this.session.expiresAt}}initAutoSave(s){const t=this.getCurrentStep();this.autoSaveManager.initAutoSave(t.id,s,this.saveProgress.bind(this))}clearAutoSave(){const s=this.getCurrentStep();this.autoSaveManager.clearAutoSave(s.id)}getSaveStatus(){return this.autoSaveManager.getSaveStatus()}destroy(){this.autoSaveManager.destroy()}async validateCurrentStep(){const s=this.getCurrentStep(),t=this.getStepData(s.id),n=Ke[s.id];if(!n)return{valid:!0,errors:[]};try{const d=await n(t);return this.stepErrors[s.id]=d.errors||[],d}catch(d){return{valid:!1,errors:[d instanceof Error?d.message:"Validation failed"]}}}getStepData(s){return this.stepData[s]||{}}setStepData(s,t){this.stepData[s]={...this.stepData[s],...t}}getCurrentStepErrors(){const s=this.getCurrentStep();return this.stepErrors[s.id]||[]}clearStepErrors(s){delete this.stepErrors[s]}isGovernmentRequiredStep(s){return["i9-complete","w4-form"].includes(s)}getEstimatedTimeRemaining(){return this.steps.slice(this.currentStepIndex).reduce((t,n)=>t+(n.estimatedMinutes||5),0)}}function Bt({steps:r,currentStep:s,completedSteps:t,percentComplete:n,estimatedTimeRemaining:d,federalStepsCompleted:x=0,totalFederalSteps:o=0}){return e.jsx("div",{className:"bg-white border-b border-gray-200 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Onboarding Progress"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Step ",s+1," of ",r.length," • ",t.length,"/",r.length," completed"]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-600",children:[o>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Te,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{children:["Federal: ",x,"/",o]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(St,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:["~",d," min remaining"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(te,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{className:"font-medium",children:[Math.round(n),"% Complete"]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{value:n,className:"w-full h-3 bg-gray-200 rounded-full overflow-hidden"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-white drop-shadow-sm",children:[Math.round(n),"%"]})})]}),e.jsx("div",{className:"mt-4 flex justify-between items-center",children:r.map((S,v)=>{const h=t.includes(S.id),g=v===s,j=v<=s||h;return e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold transition-colors ${h?"bg-green-500 text-white":g?"bg-blue-600 text-white":j?"bg-gray-300 text-gray-700":"bg-gray-100 text-gray-400"}`,children:h?e.jsx(te,{className:"h-4 w-4"}):e.jsx("span",{children:v+1})}),e.jsx("span",{className:`text-xs text-center max-w-16 truncate ${g?"text-blue-600 font-medium":"text-gray-500"}`,title:S.name,children:S.name}),S.governmentRequired&&e.jsx(Te,{className:"h-3 w-3 text-blue-500",title:"Federal Requirement"})]},S.id)})})]})})}function Rt({showPrevious:r,showNext:s,showSave:t,nextButtonText:n="Next",onPrevious:d,onNext:x,onSave:o,disabled:S=!1,saving:v=!1,hasErrors:h=!1,language:g="en"}){const w={en:{previous:"Previous",next:"Next",save:"Save",saving:"Saving...",continue:"Continue",submit:"Submit",review:"Review & Submit"},es:{previous:"Anterior",next:"Siguiente",save:"Guardar",saving:"Guardando...",continue:"Continuar",submit:"Enviar",review:"Revisar y Enviar"}}[g];return e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-4 pt-6 border-t border-gray-200",children:[e.jsx("div",{className:"order-2 sm:order-1",children:r?e.jsxs(se,{variant:"outline",onClick:()=>{oe(),d()},disabled:S||v,className:"w-full sm:w-auto flex items-center space-x-2 button-transition",children:[e.jsx(yt,{className:"h-4 w-4"}),e.jsx("span",{children:w.previous})]}):e.jsx("div",{})}),t&&o&&e.jsx("div",{className:"order-3 sm:order-2",children:e.jsx(se,{variant:"secondary",onClick:o,disabled:S||v,className:"w-full sm:w-auto flex items-center space-x-2 button-transition",children:v?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:w.saving})]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsx("span",{children:w.save})]})})}),e.jsx("div",{className:"order-1 sm:order-3",children:s&&e.jsx(se,{size:"lg",onClick:()=>{oe(),x()},disabled:S||v,className:`w-full sm:w-auto flex items-center space-x-2 font-semibold button-transition ${h?"bg-red-600 hover:bg-red-700 text-white animate-pulse":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:v?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:w.saving})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:n==="Next"?w.next:n==="Continue"?w.continue:n==="Submit"?w.submit:n==="Review & Submit"?w.review:n}),e.jsx(Nt,{className:"h-4 w-4"})]})})})]})}const ne=[{id:"us-passport",title:"U.S. Passport",description:"Passport or Passport Card",icon:e.jsx(Ie,{className:"h-5 w-5"}),category:"listA",apiType:"us_passport"},{id:"green-card",title:"Permanent Resident Card",description:"Green Card (I-551)",icon:e.jsx(ue,{className:"h-5 w-5"}),category:"listA",apiType:"permanent_resident_card"},{id:"foreign-passport",title:"Foreign Passport with I-94",description:"With temporary I-551 stamp or visa",icon:e.jsx(Pt,{className:"h-5 w-5"}),category:"listA",apiType:"foreign_passport"},{id:"employment-auth-card",title:"Employment Authorization Card",description:"EAD Card (I-766)",icon:e.jsx(Et,{className:"h-5 w-5"}),category:"listA",apiType:"employment_authorization_card"},{id:"drivers-license",title:"Driver's License",description:"State-issued driver's license",icon:e.jsx(Ee,{className:"h-5 w-5"}),category:"listB",apiType:"drivers_license"},{id:"state-id",title:"State ID Card",description:"State-issued identification card",icon:e.jsx(ue,{className:"h-5 w-5"}),category:"listB",apiType:"state_id"},{id:"school-id",title:"School ID with Photo",description:"With photo (if under 18)",icon:e.jsx(It,{className:"h-5 w-5"}),category:"listB",apiType:"school_id"},{id:"ssn-card",title:"Social Security Card",description:"Unrestricted Social Security card",icon:e.jsx(ue,{className:"h-5 w-5"}),category:"listC",apiType:"social_security_card"},{id:"birth-certificate",title:"Birth Certificate",description:"Original or certified copy",icon:e.jsx(Ce,{className:"h-5 w-5"}),category:"listC",apiType:"birth_certificate"}];function qt({onComplete:r,language:s="en",initialData:t}){const[n,d]=y.useState(""),[x,o]=y.useState([]),[S,v]=y.useState([]),[h,g]=y.useState(!1),[j,w]=y.useState("");y.useEffect(()=>{if(t){if(console.log("DocumentUploadEnhanced - Loading from initialData:",t),t.documentChoice&&d(t.documentChoice),t.selectedDocuments&&o(t.selectedDocuments),t.ssn&&w(t.ssn),t.uploadedDocuments){const a=t.uploadedDocuments.map(i=>({...i,file:null,status:i.status==="complete"?"complete":"error"}));v(a)}if(t.extractedData&&t.extractedData.length>0){const a=t.extractedData.map(i=>({id:i.id||`doc-${Date.now()}-${Math.random()}`,file:null,type:i.type||i.documentType,status:"complete",extractedData:i}));v(a)}}else{const a=sessionStorage.getItem("document_upload_data");if(a)try{const i=JSON.parse(a);if(i.documentChoice&&d(i.documentChoice),i.selectedDocuments&&o(i.selectedDocuments),i.ssn&&w(i.ssn),i.uploadedDocuments){const p=i.uploadedDocuments.map(N=>({...N,file:null,status:N.status==="complete"?"complete":"error"}));v(p)}}catch(i){console.error("Failed to parse saved document data:",i)}}},[t]),y.useEffect(()=>{const a={documentChoice:n,selectedDocuments:x,ssn:j,uploadedDocuments:S.map(i=>({id:i.id,type:i.type,status:i.status,extractedData:i.extractedData,error:i.error}))};sessionStorage.setItem("document_upload_data",JSON.stringify(a))},[n,x,j,S]);const c={en:{title:"Upload Documents",subtitle:"Upload your documents for I-9 verification",question:"Which documents do you have?",option1:"U.S. Passport or Green Card",option1Desc:"One document establishes both identity and work authorization",option2:"Driver's License",option2Desc:"You'll also need to upload your Social Security card",option3:"Other documents",option3Desc:"See all acceptable document options",upload:"Upload",processing:"Processing your document...",extracting:"Extracting information...",complete:"Processing complete!",error:"Error processing document",retry:"Retry",remove:"Remove",continue:"Continue",documentNumber:"Document Number",expires:"Expires",issuer:"Issuing Authority",changeSelection:"Change Document Selection",listATitle:"List A Documents",listADesc:"Documents that establish both identity and employment authorization",listBTitle:"List B Documents",listBDesc:"Documents that establish identity only",listCTitle:"List C Documents",listCDesc:"Documents that establish employment authorization only",listBCNote:"You must provide one document from List B AND one from List C",ssnLabel:"Social Security Number",ssnPlaceholder:"Enter your 9-digit SSN (XXX-XX-XXXX)",ssnRequired:"SSN is required for List A documents"},es:{title:"Cargar Documentos",subtitle:"Cargue sus documentos para verificación I-9",question:"¿Qué documentos tiene?",option1:"Pasaporte de EE.UU. o Tarjeta Verde",option1Desc:"Un documento establece identidad y autorización de trabajo",option2:"Licencia de Conducir",option2Desc:"También necesitará cargar su tarjeta de Seguro Social",option3:"Otros documentos",option3Desc:"Ver todas las opciones de documentos aceptables",upload:"Cargar",processing:"Procesando su documento...",extracting:"Extrayendo información...",complete:"¡Procesamiento completo!",error:"Error al procesar documento",retry:"Reintentar",remove:"Eliminar",continue:"Continuar",documentNumber:"Número de Documento",expires:"Vence",issuer:"Autoridad Emisora",changeSelection:"Cambiar Selección de Documento",listATitle:"Documentos de Lista A",listADesc:"Documentos que establecen identidad y autorización de empleo",listBTitle:"Documentos de Lista B",listBDesc:"Documentos que establecen solo identidad",listCTitle:"Documentos de Lista C",listCDesc:"Documentos que establecen solo autorización de empleo",listBCNote:"Debe proporcionar un documento de Lista B Y uno de Lista C",ssnLabel:"Número de Seguro Social",ssnPlaceholder:"Ingrese su SSN de 9 dígitos (XXX-XX-XXXX)",ssnRequired:"El SSN es requerido para documentos de Lista A"}}[s],$=()=>{v([]),d(""),o([]),w(""),sessionStorage.removeItem("document_upload_data")},f=async(a,i)=>{const p=`${i}-${Date.now()}`;v(N=>[...N,{id:p,file:a,type:i,status:"uploading"}]);try{const N=new FormData;N.append("file",a),N.append("document_type",i),v(q=>q.map(z=>z.id===p?{...z,status:"processing"}:z));const m=await fe.post("/api/documents/process",N,{headers:{"Content-Type":"multipart/form-data"}});console.log("Document processing response:",m.data),console.log("Document type:",i);const k=m.data.data||m.data;console.log("Extracted data for",i,":",k),i==="social_security_card"&&k.ssn&&console.log("SSN found in response:",k.ssn),v(q=>q.map(z=>z.id===p?{...z,status:"complete",extractedData:k}:z))}catch(N){console.error("Document processing error:",N),v(F=>F.map(m=>m.id===p?{...m,status:"error",error:"Failed to process document"}:m))}},C=async(a,i)=>{var N;const p=(N=a.target.files)==null?void 0:N[0];if(p){if(!p.type.startsWith("image/")&&p.type!=="application/pdf"){alert("Please upload an image or PDF file");return}g(!0),await f(p,i),g(!1)}},D=()=>{if(n==="passport"){const a=S.some(p=>{const N=ne.find(F=>F.apiType===p.type);return(N==null?void 0:N.category)==="listA"&&p.status==="complete"}),i=j.trim().length>0;return a&&i}else if(n==="dl_ssn"){const a=S.some(p=>p.type==="drivers_license"&&p.status==="complete"),i=S.some(p=>p.type==="social_security_card"&&p.status==="complete");return a&&i}else if(n==="other"){const a=S.filter(F=>F.status==="complete");if(a.some(F=>{const m=ne.find(k=>k.apiType===F.type);return(m==null?void 0:m.category)==="listA"}))return!0;const p=a.some(F=>{const m=ne.find(k=>k.apiType===F.type);return(m==null?void 0:m.category)==="listB"}),N=a.some(F=>{const m=ne.find(k=>k.apiType===F.type);return(m==null?void 0:m.category)==="listC"});return p&&N}return!1},A=()=>{console.log("handleComplete - uploadedDocuments:",S);const a=S.filter(p=>p.status==="complete").map(p=>(console.log("Processing document:",p.type,"with extractedData:",p.extractedData),{documentType:p.type,type:p.type,...p.extractedData}));console.log("DocumentUploadEnhanced - Final extracted data array:",a);const i=a.find(p=>p.documentType==="social_security_card");console.log("SSN document found:",i),sessionStorage.removeItem("document_upload_data"),r({uploadedDocuments:S.map(p=>{var N;return{type:p.type,fileName:((N=p.file)==null?void 0:N.name)||`${p.type.replace(/_/g," ").replace(/\b\w/g,F=>F.toUpperCase())}`}}),extractedData:a,ssn:n==="passport"?j:void 0})};return e.jsxs("div",{className:"space-y-6",children:[!n&&e.jsxs(Y,{children:[e.jsx(Q,{children:e.jsx(ee,{children:c.question})}),e.jsx(Z,{children:e.jsx(Ft,{onValueChange:a=>d(a),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start space-x-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx(ve,{value:"passport",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:c.option1}),e.jsx("p",{className:"text-sm text-gray-600",children:c.option1Desc})]})]}),e.jsxs("label",{className:"flex items-start space-x-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx(ve,{value:"dl_ssn",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:c.option2}),e.jsx("p",{className:"text-sm text-gray-600",children:c.option2Desc})]})]}),e.jsxs("label",{className:"flex items-start space-x-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx(ve,{value:"other",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:c.option3}),e.jsx("p",{className:"text-sm text-gray-600",children:c.option3Desc})]})]})]})})})]}),n&&e.jsx("div",{className:"flex justify-start mb-4",children:e.jsxs(se,{variant:"outline",onClick:$,className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),c.changeSelection]})}),n==="passport"&&e.jsxs(Y,{children:[e.jsx(Q,{children:e.jsx(ee,{children:c.ssnLabel})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(Tt,{htmlFor:"ssn-input",children:c.ssnLabel}),e.jsx(_t,{id:"ssn-input",type:"text",placeholder:c.ssnPlaceholder,value:j,onChange:a=>{let i=a.target.value.replace(/\D/g,"");i.length>0&&(i.length<=3?i=i:i.length<=5?i=i.slice(0,3)+"-"+i.slice(3):i=i.slice(0,3)+"-"+i.slice(3,5)+"-"+i.slice(5,9)),w(i)},maxLength:11,className:"font-mono"}),j.trim().length===0&&e.jsx("p",{className:"text-sm text-amber-600",children:c.ssnRequired})]})})]}),n==="passport"&&e.jsxs(Y,{children:[e.jsx(Q,{children:e.jsx(ee,{children:c.option1})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsx("div",{className:"p-4 border-2 border-dashed rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ie,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsxs("label",{htmlFor:"passport-upload",className:"cursor-pointer",children:[e.jsxs("span",{className:"text-blue-600 hover:text-blue-700 font-medium",children:[c.upload," U.S. Passport"]}),e.jsx("input",{id:"passport-upload",type:"file",accept:"image/*,.pdf",onChange:a=>C(a,"us_passport"),className:"hidden",disabled:h})]})]})}),e.jsx("div",{className:"p-4 border-2 border-dashed rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsxs("label",{htmlFor:"greencard-upload",className:"cursor-pointer",children:[e.jsxs("span",{className:"text-blue-600 hover:text-blue-700 font-medium",children:[c.upload," Green Card"]}),e.jsx("input",{id:"greencard-upload",type:"file",accept:"image/*,.pdf",onChange:a=>C(a,"permanent_resident_card"),className:"hidden",disabled:h})]})]})})]})]}),n==="dl_ssn"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Y,{children:[e.jsx(Q,{children:e.jsx(ee,{children:"Driver's License"})}),e.jsx(Z,{children:e.jsx("div",{className:"p-4 border-2 border-dashed rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ee,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsxs("label",{htmlFor:"dl-upload",className:"cursor-pointer",children:[e.jsxs("span",{className:"text-blue-600 hover:text-blue-700 font-medium",children:[c.upload," Driver's License"]}),e.jsx("input",{id:"dl-upload",type:"file",accept:"image/*,.pdf",onChange:a=>C(a,"drivers_license"),className:"hidden",disabled:h})]})]})})})]}),e.jsxs(Y,{children:[e.jsx(Q,{children:e.jsx(ee,{children:"Social Security Card"})}),e.jsx(Z,{children:e.jsx("div",{className:"p-4 border-2 border-dashed rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsxs("label",{htmlFor:"ssn-upload",className:"cursor-pointer",children:[e.jsxs("span",{className:"text-blue-600 hover:text-blue-700 font-medium",children:[c.upload," Social Security Card"]}),e.jsx("input",{id:"ssn-upload",type:"file",accept:"image/*,.pdf",onChange:a=>C(a,"social_security_card"),className:"hidden",disabled:h})]})]})})})]})]}),n==="other"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ce,{className:"bg-blue-50 border-blue-200",children:[e.jsx(Ge,{className:"h-4 w-4 text-blue-600"}),e.jsx(de,{className:"text-blue-800",children:c.listBCNote})]}),e.jsxs(Y,{children:[e.jsxs(Q,{children:[e.jsx(ee,{className:"text-lg",children:c.listATitle}),e.jsx("p",{className:"text-sm text-gray-600",children:c.listADesc})]}),e.jsx(Z,{className:"space-y-3",children:ne.filter(a=>a.category==="listA").map(a=>e.jsx("div",{className:"p-4 border-2 border-dashed rounded-lg hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"text-center",children:[a.icon,e.jsx("p",{className:"mt-2 font-medium",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description}),e.jsxs("label",{htmlFor:`${a.id}-upload`,className:"cursor-pointer",children:[e.jsx("span",{className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:c.upload}),e.jsx("input",{id:`${a.id}-upload`,type:"file",accept:"image/*,.pdf",onChange:i=>C(i,a.apiType),className:"hidden",disabled:h})]})]})},a.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(Y,{children:[e.jsxs(Q,{children:[e.jsx(ee,{className:"text-lg",children:c.listBTitle}),e.jsx("p",{className:"text-sm text-gray-600",children:c.listBDesc})]}),e.jsx(Z,{className:"space-y-3",children:ne.filter(a=>a.category==="listB").map(a=>e.jsx("div",{className:"p-4 border-2 border-dashed rounded-lg hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"text-center",children:[a.icon,e.jsx("p",{className:"mt-2 font-medium text-sm",children:a.title}),e.jsx("p",{className:"text-xs text-gray-600",children:a.description}),e.jsxs("label",{htmlFor:`${a.id}-upload`,className:"cursor-pointer",children:[e.jsx("span",{className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:c.upload}),e.jsx("input",{id:`${a.id}-upload`,type:"file",accept:"image/*,.pdf",onChange:i=>C(i,a.apiType),className:"hidden",disabled:h})]})]})},a.id))})]}),e.jsxs(Y,{children:[e.jsxs(Q,{children:[e.jsx(ee,{className:"text-lg",children:c.listCTitle}),e.jsx("p",{className:"text-sm text-gray-600",children:c.listCDesc})]}),e.jsx(Z,{className:"space-y-3",children:ne.filter(a=>a.category==="listC").map(a=>e.jsx("div",{className:"p-4 border-2 border-dashed rounded-lg hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"text-center",children:[a.icon,e.jsx("p",{className:"mt-2 font-medium text-sm",children:a.title}),e.jsx("p",{className:"text-xs text-gray-600",children:a.description}),e.jsxs("label",{htmlFor:`${a.id}-upload`,className:"cursor-pointer",children:[e.jsx("span",{className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:c.upload}),e.jsx("input",{id:`${a.id}-upload`,type:"file",accept:"image/*,.pdf",onChange:i=>C(i,a.apiType),className:"hidden",disabled:h})]})]})},a.id))})]})]})]}),S.map(a=>{var i;return e.jsx(Y,{className:"relative",children:e.jsxs(Z,{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ce,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((i=a.file)==null?void 0:i.name)||`${a.type.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase())}`}),a.status==="uploading"&&e.jsxs("p",{className:"text-sm text-gray-600",children:[c.upload,"..."]}),a.status==="processing"&&e.jsx("p",{className:"text-sm text-blue-600",children:c.extracting}),a.status==="complete"&&a.extractedData&&e.jsxs("div",{className:"text-sm text-green-600",children:[a.extractedData.documentNumber&&e.jsxs("p",{children:[c.documentNumber,": ",a.extractedData.documentNumber]}),a.extractedData.expirationDate&&e.jsxs("p",{children:[c.expires,": ",a.extractedData.expirationDate]})]}),a.status==="error"&&e.jsx("p",{className:"text-sm text-red-600",children:a.error})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a.status==="uploading"&&e.jsx(Ne,{className:"h-4 w-4 animate-spin text-gray-400"}),a.status==="processing"&&e.jsx(Ne,{className:"h-4 w-4 animate-spin text-blue-600"}),a.status==="complete"&&e.jsx(te,{className:"h-4 w-4 text-green-600"}),a.status==="error"&&e.jsx(se,{size:"sm",variant:"ghost",onClick:()=>{v(p=>p.filter(N=>N.id!==a.id))},children:e.jsx(Ve,{className:"h-4 w-4"})})]})]}),a.status==="processing"&&e.jsx(Ae,{value:66,className:"mt-2"})]})},a.id)}),n&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(se,{onClick:A,disabled:!D()||h,size:"lg",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"}),c.processing]}):e.jsxs(e.Fragment,{children:[c.continue,D()&&e.jsx(te,{className:"ml-2 h-4 w-4"})]})})})]})}function ie(r){if(!r)return"";try{const s=r.split("-");if(s.length!==3)return console.error("Invalid date format:",r),"";const t=parseInt(s[0]),n=parseInt(s[1]),d=parseInt(s[2]);if(isNaN(t)||isNaN(n)||isNaN(d))return console.error("Invalid date components:",r),"";const x=String(n).padStart(2,"0"),o=String(d).padStart(2,"0"),S=String(t);return`${x}/${o}/${S}`}catch(s){return console.error("Error formatting date:",s),""}}async function Ht(r){var s,t;console.log("generateCleanI9Pdf called with data:",r);try{const d=await fetch("/i9-form-template.pdf").then(f=>f.arrayBuffer()),x=await At.load(d),o=x.getForm(),S=o.getFields();console.log(`Total fields in PDF: ${S.length}`);const v=new Set,h=new Set,g=new Set;S.forEach(f=>{const C=f.getName(),D=C.toLowerCase();D.includes("preparer")||D.includes("translator")?g.add(C):D.includes("list a")||D.includes("list b")||D.includes("list c")||D.includes("section 2")||D.includes("document title")||D.includes("issuing authority")?h.add(C):v.add(C)}),console.log(`Section 1 fields: ${v.size}`),console.log(`Section 2 fields: ${h.size}`),console.log(`Supplement fields: ${g.size}`),console.log(`
=== FILLING SECTION 1 ===`);const j={"Last Name (Family Name)":(r.last_name||"").toUpperCase(),"First Name Given Name":(r.first_name||"").toUpperCase(),"Employee Middle Initial (if any)":(r.middle_initial||"").toUpperCase(),"Employee Other Last Names Used (if any)":(r.other_names||"").toUpperCase(),"Address Street Number and Name":r.address||"","Apt Number (if any)":r.apt_number||"","City or Town":r.city||"","ZIP Code":r.zip_code||"","Date of Birth mmddyyyy":ie(r.date_of_birth||""),"US Social Security Number":(r.ssn||"").replace(/\D/g,""),"Employees E-mail Address":r.email||"","Telephone Number":(r.phone||"").replace(/\D/g,"")};for(const[f,C]of Object.entries(j))if(C&&!g.has(f))try{o.getTextField(f).setText(C),console.log(`✓ Filled Section 1 field: "${f}"`)}catch(D){console.error(`✗ Failed to fill Section 1 field "${f}":`,D)}if(r.state&&!g.has("State"))try{const f=o.getDropdown("State");f.getOptions().includes(r.state)&&(f.select(r.state),console.log(`✓ Set state dropdown: ${r.state}`))}catch{try{o.getTextField("State").setText(r.state),console.log(`✓ Set state as text field: ${r.state}`)}catch(C){console.error("✗ Failed to set state:",C)}}const U={citizen:"CB_1",national:"CB_2",permanent_resident:"CB_3",authorized_alien:"CB_4"}[r.citizenship_status];if(U)try{o.getCheckBox(U).check(),console.log(`✓ Checked citizenship: ${U}`)}catch(f){console.error("✗ Failed to check citizenship:",f)}if(r.citizenship_status==="permanent_resident"&&r.alien_registration_number)try{o.getTextField("3 A lawful permanent resident Enter USCIS or ANumber").setText(r.alien_registration_number),console.log("✓ Filled permanent resident USCIS number")}catch(f){console.error("✗ Failed to fill USCIS number:",f)}const c=ie(new Date().toISOString());try{o.getTextField("Today's Date mmddyyy").setText(c),console.log(`✓ Filled Section 1 employee signature date: ${c}`)}catch(f){console.log("⚠️ Could not fill Section 1 date field:",f)}if((s=r.signatureData)!=null&&s.signature)try{let f=!1;try{const C=o.getTextField("Signature of Employee"),D=await _e(r.signatureData.signature),a=C.acroField.getWidgets();if(a&&a.length>0){const p=a[0].getRectangle(),N=D.split(",")[1],F=Uint8Array.from(atob(N),B=>B.charCodeAt(0)),m=await x.embedPng(F),q=x.getPages()[0],z=p.width,G=p.height,H=z*1.5,K=G*1.5,W=m.width,X=m.height,ae=H/W,re=K/X,le=Math.min(ae,re,.35),b=W*le,I=X*le,P=p.x+(z-b)/2,L=p.y+(G-I)/2;q.drawImage(m,{x:P,y:L,width:b,height:I}),f=!0,console.log(`✓ Added signature to field at: ${P.toFixed(1)}, ${L.toFixed(1)}`)}}catch(C){console.log("Could not use signature field directly:",C)}if(!f){const D=(await _e(r.signatureData.signature)).split(",")[1],A=Uint8Array.from(atob(D),k=>k.charCodeAt(0)),a=await x.embedPng(A),p=x.getPages()[0],N=.22,F=a.width*N,m=a.height*N;p.drawImage(a,{x:50,y:330,width:F,height:m}),console.log("✓ Added signature using fallback positioning")}}catch(f){console.error("✗ Failed to add signature image:",f)}if((t=r.section2)!=null&&t.documents){console.log(`
=== FILLING SECTION 2 ===`);const f=Array.isArray(r.section2.documents)?r.section2.documents:[r.section2.documents],C={"Last Name Family Name from Section 1":(r.last_name||"").toUpperCase(),"First Name Given Name from Section 1":(r.first_name||"").toUpperCase(),"Middle initial if any from Section 1":(r.middle_initial||"").toUpperCase()};for(const[m,k]of Object.entries(C))if(k&&h.has(m))try{o.getTextField(m).setText(k),console.log(`✓ Filled Section 2 employee field: "${m}"`)}catch(q){console.error("✗ Failed to fill Section 2 field:",q)}const D=f.find(m=>m.documentType==="us_passport"),A=f.find(m=>m.documentType==="permanent_resident_card"),a=f.find(m=>m.documentType==="foreign_passport"),i=f.find(m=>m.documentType==="employment_authorization_card");if(D)try{o.getTextField("Document Title 1").setText("U.S. Passport"),o.getTextField("Issuing Authority 1").setText("U.S. Department of State"),o.getTextField("Document Number 0 (if any)").setText(D.documentNumber||""),D.expirationDate&&o.getTextField("Expiration Date if any").setText(ie(D.expirationDate)),console.log("✓ Filled List A (U.S. Passport) fields")}catch(m){console.error("✗ Failed to fill U.S. Passport fields:",m)}else if(A)try{o.getTextField("Document Title 1").setText("Permanent Resident Card"),o.getTextField("Issuing Authority 1").setText("USCIS"),o.getTextField("Document Number 0 (if any)").setText(A.documentNumber||""),A.expirationDate&&o.getTextField("Expiration Date if any").setText(ie(A.expirationDate)),console.log("✓ Filled List A (Permanent Resident Card) fields")}catch(m){console.error("✗ Failed to fill Permanent Resident Card fields:",m)}else if(a)try{const m=a.issuingCountry||a.issuingAuthority||"";o.getTextField("Document Title 1").setText("Foreign Passport"),o.getTextField("Issuing Authority 1").setText(m),o.getTextField("Document Number 0 (if any)").setText(a.documentNumber||""),a.expirationDate&&o.getTextField("Expiration Date if any").setText(ie(a.expirationDate)),console.log("✓ Filled List A (Foreign Passport) fields")}catch(m){console.error("✗ Failed to fill Foreign Passport fields:",m)}else if(i)try{o.getTextField("Document Title 1").setText("Employment Authorization Document"),o.getTextField("Issuing Authority 1").setText("USCIS"),o.getTextField("Document Number 0 (if any)").setText(i.documentNumber||""),i.expirationDate&&o.getTextField("Expiration Date if any").setText(ie(i.expirationDate)),console.log("✓ Filled List A (Employment Authorization Document) fields")}catch(m){console.error("✗ Failed to fill Employment Authorization Document fields:",m)}const p=D||A||a||i,N=f.find(m=>m.documentType==="drivers_license"),F=f.find(m=>m.documentType==="social_security_card");if(p)console.log("ℹ️ Skipping List B/C documents since List A document was provided");else{if(N)try{o.getTextField("List B Document 1 Title").setText("Driver's License"),o.getTextField("List B Issuing Authority 1").setText(N.issuingAuthority||""),o.getTextField("List B Document Number 1").setText(N.documentNumber||""),N.expirationDate&&(o.getTextField("List B Expiration Date 1").setText(ie(N.expirationDate)),console.log(`✓ Added DL expiration date: ${N.expirationDate}`)),console.log("✓ Filled List B (Driver's License) fields")}catch(m){console.error("✗ Failed to fill List B fields:",m)}if(F)try{o.getTextField("List C Document Title 1").setText("Social Security Card"),o.getTextField("List C Issuing Authority 1").setText("Social Security Administration"),o.getTextField("List C Document Number 1").setText(r.ssn||""),console.log("✓ Filled List C (SSN) fields")}catch(m){console.error("✗ Failed to fill List C fields:",m)}}try{o.getTextField("S2 Todays Date mmddyyyy").setText(c),console.log(`✓ Filled Section 2 employer verification date: ${c}`)}catch(m){console.error("✗ Failed to fill Section 2 date field:",m)}}const $=await x.save();return console.log(`
✓ PDF generated successfully`),$}catch(n){throw console.error("Error in generateCleanI9Pdf:",n),n}}const ge=r=>{var t;const s={formData:r.formData,supplementsData:r.supplementsData,documentsData:(t=r.documentsData)==null?void 0:t.extractedData};return JSON.stringify(s)};function Jt({currentStep:r,progress:s,markStepComplete:t,saveProgress:n,goToNextStep:d,language:x="en",employee:o,property:S}){var De;const[v,h]=y.useState("form"),[g,j]=y.useState({}),[w,U]=y.useState(null),[c,$]=y.useState(null),[f,C]=y.useState(!1),[D,A]=y.useState(!1),[a,i]=y.useState(!1),[p,N]=y.useState(!1),[F,m]=y.useState(null),[k,q]=y.useState(null),[z,G]=y.useState({hasWarning:!1,acknowledged:!1}),[H,K]=y.useState("none"),[W,X]=y.useState(null),[ae,re]=y.useState(!1),{errors:le,fieldErrors:b}=Ye(at),I={activeTab:v,formData:g,supplementsData:w,documentsData:c,formComplete:f,supplementsComplete:D,documentsComplete:a,needsSupplements:H,isSigned:p,ssnMismatch:z,signatureData:F,signedFormDataHash:k};y.useEffect(()=>{g.citizenship_status&&console.log("Auto-save formData citizenship_status:",g.citizenship_status),g.ssn&&(c!=null&&c.extractedData)&&B()},[g.citizenship_status,g.ssn,c]);const{saveStatus:P}=qe(I,{onSave:async u=>{var l;console.log("I9CompleteStep - Saving data with citizenship_status:",(l=u.formData)==null?void 0:l.citizenship_status),await n(r.id,u),sessionStorage.setItem(`onboarding_${r.id}_data`,JSON.stringify(u))}});y.useEffect(()=>{(async()=>{var O;s.completedSteps.includes(r.id)&&(N(!0),C(!0),A(!0),i(!0),h("preview"));let l=null;const _=sessionStorage.getItem(`onboarding_${r.id}_data`);if(_)try{l=JSON.parse(_),console.log("Loading saved I9 data from session:",{hasFormData:!!l.formData,citizenship_status:(O=l.formData)==null?void 0:O.citizenship_status,formComplete:l.formComplete})}catch(T){console.error("Failed to parse saved data:",T)}if(o!=null&&o.id)try{const M=await fetch(`/api/onboarding/${o.id}/i9-complete`);if(M.ok){const R=await M.json();R.success&&R.data&&Object.keys(R.data).length>0&&(console.log("I9CompleteStep - Loaded data from cloud:",R.data),(R.data.formData&&(R.data.formData.citizenship_status||R.data.formData.last_name)||!l)&&(l=R.data,sessionStorage.setItem(`onboarding_${r.id}_data`,JSON.stringify(R.data))))}}catch(T){console.error("Failed to load I-9 data from cloud:",T)}l&&(l.formData?(j(l.formData),console.log("Set formData with citizenship_status:",l.formData.citizenship_status)):(l.citizenship_status||l.last_name||l.first_name)&&(j(l),console.log("Set formData from flat structure with citizenship_status:",l.citizenship_status)),l.supplementsData&&U(l.supplementsData),l.documentsData&&$(l.documentsData),l.needsSupplements&&K(l.needsSupplements),l.formComplete&&C(l.formComplete),l.supplementsComplete&&A(l.supplementsComplete),l.documentsComplete&&i(l.documentsComplete),l.isSigned&&(N(l.isSigned),l.formComplete&&l.supplementsComplete&&l.documentsComplete&&h("preview")),l.signatureData&&m(l.signatureData),l.signedFormDataHash&&q(l.signedFormDataHash),l.ssnMismatch&&G(l.ssnMismatch),l.activeTab&&!l.isSigned&&h(l.activeTab));const E=sessionStorage.getItem("onboarding_personal-info_data");if(E)try{const T=JSON.parse(E),M=T.personalInfo||T||{};j(R=>{if(R.last_name)return R;const he={last_name:M.lastName||"",first_name:M.firstName||"",middle_initial:M.middleInitial||"",date_of_birth:M.dateOfBirth||"",ssn:M.ssn||"",email:M.email||"",phone:M.phone||"",address:M.address||"",apt_number:M.aptNumber||M.apartment||"",city:M.city||"",state:M.state||"",zip_code:M.zipCode||""};return{...R,...he}})}catch(T){console.error("Failed to parse personal info data:",T)}})()},[r.id,s.completedSteps,o]),y.useEffect(()=>{v==="preview"&&!W&&!ae&&a&&(console.log("Regenerating PDF on preview tab - formData citizenship_status:",g.citizenship_status),p&&F?(console.log("Including existing signature in PDF regeneration"),pe(c,F)):pe(c))},[v,W,ae,a,p,F]),y.useEffect(()=>()=>{X(null),j({}),U(null),$(null)},[]);const L=[{id:"form",label:x==="es"?"Llenar Formulario":"Fill Form",icon:e.jsx(Ce,{className:"h-4 w-4"}),enabled:!0,complete:f},{id:"supplements",label:x==="es"?"Suplementos":"Supplements",icon:e.jsx(kt,{className:"h-4 w-4"}),enabled:f,complete:D},{id:"documents",label:x==="es"?"Cargar Documentos":"Upload Documents",icon:e.jsx(rt,{className:"h-4 w-4"}),enabled:f&&D,complete:a},{id:"preview",label:x==="es"?"Revisar y Firmar":"Preview & Sign",icon:e.jsx(te,{className:"h-4 w-4"}),enabled:f&&D&&a,complete:p}],B=()=>{if(!g.ssn||!(c!=null&&c.extractedData))return;console.log("Checking SSN mismatch - formData.ssn:",g.ssn),console.log("Checking SSN mismatch - documentsData.extractedData:",c.extractedData);const u=c.extractedData.find(T=>T.documentType==="social_security_card"||T.type==="social_security_card");console.log("Found SSN document:",u);const l=u==null?void 0:u.ssn;if(!l){console.log("No SSN found in extracted data - checking all fields:",u),u&&console.warn("SSN card data exists but no SSN was extracted");return}const _=g.ssn.replace(/\D/g,""),E=l.replace(/\D/g,""),O=_!==E;G(T=>({...T,hasWarning:O})),O?console.log("SSN Mismatch detected:",{entered:_,extracted:E,enteredFormatted:g.ssn,extractedFormatted:l}):console.log("SSN Match confirmed")},J=u=>{const l=L.findIndex(T=>T.id===v),_=L.findIndex(T=>T.id===u);console.log("Tab change - Current formData citizenship_status:",g.citizenship_status),console.log("Tab change - Form data keys:",Object.keys(g)),console.log("Tab change - Form data values preserved:",{citizenship_status:g.citizenship_status,ssn:g.ssn?"***-**-"+g.ssn.slice(-4):"none"});const E={activeTab:u,formData:g,supplementsData:w,documentsData:c,formComplete:f,supplementsComplete:D,documentsComplete:a,needsSupplements:H,isSigned:p,ssnMismatch:z,signatureData:F,signedFormDataHash:k};sessionStorage.setItem(`onboarding_${r.id}_data`,JSON.stringify(E)),n(r.id,E),_<l&&(v==="preview"&&X(null),X(null));const O=L.find(T=>T.id===u);O!=null&&O.enabled&&(h(u),oe())},$e=async u=>{console.log("handleFormComplete - citizenship_status:",u.citizenship_status),console.log("handleFormComplete - Full data received:",Object.keys(u)),p&&k&&ge({formData:{...g,...u},supplementsData:w,documentsData:c})!==k&&(console.log("Form data changed after signing - clearing signature"),N(!1),m(null),q(null),X(null));const l={...g,...u};j(l),C(!0);const _={activeTab:"supplements",formData:l,supplementsData:w,documentsData:c,formComplete:!0,supplementsComplete:D,documentsComplete:a,needsSupplements:H,isSigned:p,ssnMismatch:z,signatureData:F,signedFormDataHash:k};if(sessionStorage.setItem(`onboarding_${r.id}_data`,JSON.stringify(_)),await n(r.id,_),o!=null&&o.id)try{await fe.post(`/api/onboarding/${o.id}/i9-section1`,{formData:l,signed:!1,formValid:!0}),console.log("I-9 Section 1 data saved to cloud")}catch(E){console.error("Failed to save I-9 Section 1 to cloud:",E)}h("supplements")},ye=async()=>{p&&k&&ge({formData:g,supplementsData:w,documentsData:c})!==k&&(console.log("Supplements data changed after signing - clearing signature"),N(!1),m(null),q(null),X(null)),A(!0),await n(r.id,{supplementsComplete:!0}),h("documents")},ze=async u=>{if(p&&k&&ge({formData:g,supplementsData:w,documentsData:u})!==k&&(console.log("Documents changed after signing - clearing signature"),N(!1),m(null),q(null),X(null)),$(u),i(!0),u.extractedData&&sessionStorage.setItem("i9_section2_data",JSON.stringify(u.extractedData)),await n(r.id,{documentsData:u,documentsComplete:!0}),console.log("Checking SSN after document upload - data.extractedData:",u.extractedData),console.log("Current formData.ssn:",g.ssn),u.extractedData&&g.ssn){const l=u.extractedData.find(E=>E.documentType==="social_security_card"||E.type==="social_security_card");console.log("Found SSN document in handleDocumentsComplete:",l);const _=l==null?void 0:l.ssn;if(console.log("Looking for SSN in document:",{ssnDocument:l,hasSSN:!!_,extractedSSN:_}),_){const E=g.ssn.replace(/\D/g,""),O=_.replace(/\D/g,""),T=E!==O;console.log("SSN Comparison:",{entered:E,extracted:O,hasWarning:T,enteredFormatted:g.ssn,extractedFormatted:_}),T?(G({hasWarning:!0,acknowledged:!1}),console.log("SSN Mismatch detected on document upload:",{entered:g.ssn,extracted:_})):(G({hasWarning:!1,acknowledged:!1}),console.log("SSN Match confirmed on document upload"))}else console.log("No SSN found in SSN document - full document:",l),l&&console.warn("SSN card uploaded but no SSN was extracted from it")}else console.log("Missing data for SSN check:",{hasExtractedData:!!u.extractedData,hasFormSSN:!!g.ssn});await pe(u),h("preview")},pe=async(u,l)=>{re(!0);try{console.log("Documents received in generateCompletePdf:",u),console.log("Extracted data:",u==null?void 0:u.extractedData);const _={...g,section2:u!=null&&u.extractedData&&u.extractedData.length>0?{documents:u.extractedData,documentVerificationDate:new Date().toISOString()}:null,supplementA:H==="translator"?w:null,signatureData:l||null};console.log("Complete form data being sent to PDF generator:",_),console.log("citizenship_status in PDF data:",_.citizenship_status);const E=await Ht(_);let O="";const T=8192;for(let R=0;R<E.length;R+=T){const he=E.slice(R,R+T);O+=String.fromCharCode.apply(null,Array.from(he))}const M=btoa(O);console.log("Setting PDF URL, base64 length:",M.length),X(M)}catch(_){console.error("Error generating PDF:",_)}finally{re(!1)}},Oe=async u=>{if(p)return;m(u);const l=ge({formData:g,supplementsData:w,documentsData:c});q(l);const _={formData:g,supplementsData:w,documentsData:c,signed:!0,isSigned:!0,signatureData:u,signedFormDataHash:l,completedAt:new Date().toISOString(),needsSupplements:H,pdfUrl:W};if(o!=null&&o.id)try{if(await fe.post(`/api/onboarding/${o.id}/i9-section1`,{formData:g,signed:!0,signatureData:u.signature,completedAt:_.completedAt,pdfUrl:W}),console.log("I-9 Section 1 with signature saved to cloud"),c&&c.uploadedDocuments){const O=c.uploadedDocuments.map(T=>({id:T.id,type:T.type,documentType:T.documentType,fileName:T.fileName,fileSize:T.fileSize,uploadedAt:T.uploadedAt,ocrData:T.ocrData}));await fe.post(`/api/onboarding/${o.id}/i9-section2`,{documentSelection:c.documentSelection||"",uploadedDocuments:O,verificationComplete:!0,completedAt:_.completedAt}),console.log("I-9 Section 2 documents saved to cloud")}}catch(E){console.error("Failed to save I-9 data to backend:",E)}await n(r.id,_),sessionStorage.setItem(`onboarding_${r.id}_data`,JSON.stringify(_)),await pe(c,u),N(!0),await t(r.id,_)},be={en:{title:"Employment Eligibility Verification (I-9)",description:"Complete all sections of Form I-9 including document upload",completionMessage:"Form I-9 has been completed successfully."},es:{title:"Verificación de Elegibilidad de Empleo (I-9)",description:"Complete todas las secciones del Formulario I-9 incluyendo carga de documentos",completionMessage:"El Formulario I-9 ha sido completado exitosamente."}}[x];return e.jsx(He,{errors:le,fieldErrors:b,saveStatus:P,children:e.jsx(Ze,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:be.title}),e.jsx("p",{className:"text-gray-600 mt-2",children:be.description})]}),p&&e.jsxs(ce,{className:"bg-green-50 border-green-200",children:[e.jsx(te,{className:"h-4 w-4 text-green-600"}),e.jsx(de,{className:"text-green-800",children:be.completionMessage})]}),z.hasWarning&&!z.acknowledged&&v==="preview"&&e.jsx(ce,{className:"bg-amber-50 border-amber-200",children:e.jsx(de,{className:"text-amber-800",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ke,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"SSN Verification Required"}),e.jsx("p",{className:"mt-1 text-sm",children:"The Social Security Number you entered in the form doesn't match the SSN on your uploaded Social Security card. This could be a simple typo or a document issue."}),e.jsxs("div",{className:"mt-2 p-3 bg-white rounded border border-amber-200",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Comparison:"}),e.jsxs("p",{className:"text-sm",children:["Form Entry: ***-**-",((De=g.ssn)==null?void 0:De.slice(-4))||"****"]}),e.jsxs("p",{className:"text-sm",children:["Document: ***-**-",(()=>{var _,E;const u=(_=c==null?void 0:c.extractedData)==null?void 0:_.find(O=>O.documentType==="social_security_card"||O.type==="social_security_card"),l=(u==null?void 0:u.ssn)||((E=u==null?void 0:u.data)==null?void 0:E.ssn);return(l==null?void 0:l.slice(-4))||"****"})()]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>{h("form"),oe()},className:"px-4 py-2 bg-white border border-amber-600 text-amber-600 rounded hover:bg-amber-50 text-sm font-medium",children:"← Fix SSN Entry"}),e.jsx("button",{onClick:()=>{h("documents"),oe()},className:"px-4 py-2 bg-white border border-amber-600 text-amber-600 rounded hover:bg-amber-50 text-sm font-medium",children:"← Re-upload Document"}),e.jsx("button",{onClick:()=>G(u=>({...u,acknowledged:!0})),className:"px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700 text-sm font-medium",children:"Continue with Mismatch"})]}),e.jsx("p",{className:"text-xs text-amber-700 italic",children:"Note: Proceeding with mismatched SSNs may cause issues during employment verification."})]})})}),e.jsxs(wt,{value:v,onValueChange:J,className:"w-full",children:[e.jsx(Ct,{className:"grid w-full grid-cols-4 mb-6",children:L.map(u=>e.jsxs(Dt,{value:u.id,disabled:!u.enabled,className:"flex items-center space-x-2",children:[u.icon,e.jsx("span",{className:"hidden sm:inline",children:u.label}),u.complete&&e.jsx(te,{className:"h-3 w-3 text-green-600 ml-1"})]},u.id))}),e.jsx(xe,{value:"form",className:"space-y-6",children:e.jsx(Qe,{onComplete:$e,initialData:g,language:x,employeeId:o==null?void 0:o.id,showPreview:!1})}),e.jsx(xe,{value:"supplements",className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:x==="es"?"¿Necesita Suplementos?":"Do You Need Supplements?"}),e.jsx(ce,{className:"bg-blue-50 border-blue-200",children:e.jsx(de,{className:"text-blue-800",children:x==="es"?"La mayoría de los empleados pueden omitir esta sección. Solo es necesaria si alguien le ayudó a traducir o completar el formulario.":"Most employees can skip this section. It's only needed if someone helped translate or complete your form."})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"supplements",value:"none",checked:H==="none",onChange:()=>K("none"),className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:x==="es"?"No necesito suplementos":"I don't need supplements"}),e.jsx("p",{className:"text-sm text-gray-600",children:x==="es"?"Completé el formulario yo mismo":"I completed the form myself"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"supplements",value:"translator",checked:H==="translator",onChange:()=>K("translator"),className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:x==="es"?"Alguien me ayudó":"Someone helped me"}),e.jsx("p",{className:"text-sm text-gray-600",children:x==="es"?"Un traductor o preparador me ayudó":"A translator or preparer helped me"})]})]})]}),H==="translator"&&e.jsx("div",{className:"mt-6",children:e.jsx(et,{initialData:w||{},language:x,onComplete:u=>{U(u),ye()},onSkip:()=>{K("none"),ye()},onBack:()=>K("none")})}),H==="none"&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:ye,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:x==="es"?"Continuar":"Continue"})})]})}),e.jsx(xe,{value:"documents",className:"space-y-6",children:e.jsx(qt,{onComplete:ze,language:x,initialData:c})}),e.jsx(xe,{value:"preview",className:"space-y-6",children:ae?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"inline-flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-gray-600",children:x==="es"?"Generando PDF...":"Generating PDF..."})]})}):p?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ce,{className:"bg-green-50 border-green-200",children:[e.jsx(te,{className:"h-4 w-4 text-green-600"}),e.jsx(de,{className:"text-green-800",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:x==="es"?"El Formulario I-9 ha sido firmado y completado exitosamente.":"Form I-9 has been signed and completed successfully."}),F&&e.jsxs("div",{className:"text-sm space-y-1",children:[F.signedAt&&e.jsxs("p",{children:[x==="es"?"Firmado el:":"Signed on:"," ",new Date(F.signedAt).toLocaleString()]}),F.ipAddress&&e.jsxs("p",{children:[x==="es"?"Dirección IP:":"IP Address:"," ",F.ipAddress]})]})]})})]}),W?e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["PDF Preview (",W.length," bytes)"]}),e.jsx(tt,{pdfData:W,height:"600px"})]}):e.jsx("p",{className:"text-sm text-gray-600",children:"Loading PDF..."}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:()=>J("documents"),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:x==="es"?"← Volver":"← Back"}),e.jsx("button",{onClick:()=>d(),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:x==="es"?"Continuar →":"Continue →"})]})]}):e.jsx(st,{formType:"i9-complete",formData:{...g,supplementsData:w,documentsData:c},title:x==="es"?"Revisar I-9 Completo":"Review Complete I-9",description:x==="es"?"Revise toda la información antes de firmar":"Review all information before signing",language:x,onSign:Oe,onBack:()=>h("documents"),usePDFPreview:!0,pdfUrl:W,federalCompliance:{formName:"Form I-9, Employment Eligibility Verification",retentionPeriod:"3 years after hire or 1 year after termination (whichever is later)",requiresWitness:!1},agreementText:x==="es"?"Atestiguo, bajo pena de perjurio, que la información proporcionada es verdadera y correcta.":"I attest, under penalty of perjury, that the information provided is true and correct."})})]})]})})})}function $s({testMode:r=!1}){const[s]=Be(),[t]=y.useState(()=>new Mt),[n,d]=y.useState(!0),[x,o]=y.useState(null),[S,v]=y.useState(null),[h,g]=y.useState(null),[j,w]=y.useState(null),[U,c]=y.useState("en"),[$,f]=y.useState([]),[C,D]=y.useState({saving:!1,lastSaved:null,error:null}),A=s.get("token")||(r?"demo-token":null),{syncStatus:a,lastSyncTime:i,syncError:p,startSync:N,syncSuccess:F,syncError:m,syncOffline:k,isOnline:q}=Ot();y.useEffect(()=>{(async()=>{if(!A){o("No onboarding token provided"),d(!1);return}try{d(!0);const I=sessionStorage.getItem("current_onboarding_token");if(I&&I!==A){const L=[];for(let B=0;B<sessionStorage.length;B++){const J=sessionStorage.key(B);J&&(J.includes("onboarding_")||J.includes("personal_info")||J.includes("company_policies")||J.includes("document_upload"))&&L.push(J)}L.forEach(B=>sessionStorage.removeItem(B))}sessionStorage.setItem("current_onboarding_token",A);const P=await t.initializeOnboarding(A);v(P),g(t.getCurrentStep()),w(t.getProgress()),P.savedFormData&&Object.keys(P.savedFormData).length>0?(console.log("Loading saved form data from cloud:",P.savedFormData),Object.entries(P.savedFormData).forEach(([L,B])=>{B&&Object.keys(B).length>0&&(console.log(`Setting cloud data for step ${L}:`,B),t.setStepData(L,B),sessionStorage.setItem(`onboarding_${L}_data`,JSON.stringify(B)))})):(console.log("No cloud data found, checking local storage"),t.steps.forEach(L=>{const B=sessionStorage.getItem(`onboarding_${L.id}_data`);if(B)try{const J=JSON.parse(B);console.log(`Loading local data for step ${L.id}:`,J),t.setStepData(L.id,J)}catch(J){console.error(`Failed to parse saved data for step ${L.id}:`,J)}})),o(null)}catch(I){console.error("Failed to initialize onboarding:",I),o(I instanceof Error?I.message:"Failed to load onboarding session")}finally{d(!1)}})()},[A,t]),y.useEffect(()=>{if(!S||!h)return;const I=setInterval(()=>{const P=t.getSaveStatus();D(P)},5e3);return()=>clearInterval(I)},[S,h,t]);const z=y.useCallback(async()=>{try{f([]);let b=t.getStepData(h.id);if(h.id==="personal-info"||h.id==="w4-form"||h.id==="direct-deposit"){const P=sessionStorage.getItem(`onboarding_${h.id}_data`);if(P)try{b=JSON.parse(P),t.setStepData(h.id,b)}catch(L){console.error("Failed to parse saved data:",L)}}console.log("Validating step data:",b);const I=await t.validateCurrentStep();if(!I.valid){console.log("Validation failed:",I),f(I.errors),Fe();return}await t.markStepComplete(h.id,b),t.goToNextStep(),g(t.getCurrentStep()),w(t.getProgress()),oe()}catch(b){console.error("Failed to proceed to next step:",b),f([b instanceof Error?b.message:"Failed to proceed"]),Fe()}},[h,t]),G=y.useCallback(()=>{t.goToPreviousStep(),g(t.getCurrentStep()),w(t.getProgress()),oe()},[t]),H=y.useCallback(async(b,I)=>{if(h)try{I&&(t.setStepData(b,I),sessionStorage.setItem(`onboarding_${b}_data`,JSON.stringify(I))),N(),await t.saveProgress(b,I),console.log(`Progress saved for step ${b}`),F()}catch(P){console.error("Failed to save progress:",P),m(P instanceof Error?P.message:"Failed to save progress"),q||k()}},[h,t,N,F,m,q,k]),K=y.useCallback(async(b,I)=>{try{await t.markStepComplete(b,I),w(t.getProgress())}catch(P){console.error("Failed to mark step complete:",P)}},[t]),W=y.useCallback(b=>{c(b),h&&H({language_preference:b})},[h,H]),X=y.useCallback(()=>{if(!S||!h||!j)throw new Error("Session not properly initialized");return{currentStep:{id:h.id,name:h.name,order:h.order,required:h.required},progress:{completedSteps:j.completedSteps,currentStepIndex:j.currentStepIndex,totalSteps:j.totalSteps,percentComplete:j.percentComplete},markStepComplete:K,saveProgress:H,goToNextStep:z,goToPreviousStep:G,language:U,employee:S.employee,property:S.property,sessionToken:S.sessionToken,expiresAt:S.expiresAt}},[S,h,j,U,K,H,z,G]),ae=()=>{if(!h)return null;const b=X();switch(h.id){case"welcome":return e.jsx(ft,{...b});case"personal-info":return e.jsx(gt,{...b});case"job-details":return e.jsx(xt,{...b});case"company-policies":return e.jsx(ht,{...b});case"i9-section1":return e.jsx(pt,{...b});case"i9-complete":return e.jsx(Jt,{...b});case"i9-supplements":return e.jsx(ut,{...b});case"w4-form":return e.jsx(mt,{...b});case"direct-deposit":return e.jsx(dt,{...b});case"trafficking-awareness":return e.jsx(ct,{...b});case"weapons-policy":return e.jsx(lt,{...b});case"health-insurance":return e.jsx(ot,{...b});case"document-upload":return e.jsx(it,{...b});case"final-review":return e.jsx(nt,{...b});default:return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-semibold text-heading-secondary text-gray-900 mb-2",children:"Step Not Implemented"}),e.jsxs("p",{className:"text-gray-600",children:['The step "',h.name,'" is not yet implemented.']})]})}};if(y.useEffect(()=>()=>{t.destroy()},[t]),n)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(me,{className:"h-8 w-8 text-blue-600 animate-spin mx-auto"}),e.jsx("p",{className:"text-gray-600",children:"Loading onboarding session..."})]})});if(x||!S)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-heading-primary text-gray-900 mb-2",children:"Onboarding Error"}),e.jsx("p",{className:"text-gray-600 mb-6",children:x||"Unable to load onboarding session"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",children:"Try Again"})]})})});const re=t.steps.filter(b=>b.governmentRequired),le=re.filter(b=>{var I;return(I=j==null?void 0:j.completedSteps)==null?void 0:I.includes(b.id)}).length;return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h1",{className:"text-xl font-semibold text-heading-primary text-gray-900",children:"Employee Onboarding"}),e.jsx("span",{className:"ml-4 text-sm text-gray-500",children:S.property.name})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"hidden md:block",children:e.jsx($t,{status:a,lastSyncTime:i,error:p,showDetails:!0,className:"text-sm"})}),e.jsx("div",{className:"block md:hidden",children:e.jsx(zt,{status:a,className:"w-8 h-8"})}),e.jsx("button",{onClick:()=>W(U==="en"?"es":"en"),className:"flex items-center space-x-2 px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:e.jsx("span",{children:U==="en"?"Español":"English"})})]})]})})}),h&&e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3",children:e.jsx(vt,{items:jt(["Home","Onboarding",h.name]),className:"text-sm"})})}),j&&e.jsx(Bt,{steps:t.steps,currentStep:j.currentStepIndex,completedSteps:j.completedSteps,percentComplete:j.percentComplete,estimatedTimeRemaining:t.steps.slice(j.currentStepIndex).reduce((b,I)=>b+I.estimatedMinutes,0),federalStepsCompleted:le,totalFederalSteps:re.length}),e.jsx("main",{className:"flex-1 py-6",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:e.jsx(Y,{className:"card-transition fade-in",children:e.jsxs(Z,{className:"pt-6",children:[$.length>0&&e.jsx("div",{id:"error-container",className:"mb-6",children:e.jsx(Je,{messages:$.map(b=>({message:b,type:"error"})),title:"Please fix the following issues",showIcon:!0,className:"transition-all duration-300"})}),e.jsx(Lt,{children:ae()}),j&&e.jsx(Rt,{showPrevious:j.currentStepIndex>0,showNext:j.currentStepIndex<j.totalSteps-1,showSave:!1,nextButtonText:j.currentStepIndex===j.totalSteps-1?"Submit":"Next",onPrevious:G,onNext:z,saving:C.saving,hasErrors:$.length>0,language:U})]})})})})]})}export{$s as default};
