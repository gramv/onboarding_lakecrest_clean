import{j as e}from"./radixUI-MBKqlelr.js";import{a}from"./vendor-BQUE8CnD.js";import{C as Se,b as Ce,c as Ae,a as be}from"./card-0UsC1Hfx.js";import{u as we,B as n}from"./index-BX3Jf5rY.js";import{I as S}from"./input-C7n7UaRv.js";import{B as z}from"./badge-DbL2e8Dt.js";import{D as V,b as H,c as Q,d as J}from"./dialog-BrcI6BMt.js";import{S as j,a as u,b as v,c as y,d as r}from"./select-CHEqtOpE.js";import{S as Pe,T as De,a as Me,b as ie,c as p,d as Re,e as h}from"./table-B6NKxQYn.js";import{T as Fe}from"./textarea-DeiWvvAb.js";import{L as l}from"./label-BGHhm9HA.js";import{f as W,p as X,a as E}from"./utils-Co3JUx4V.js";import{B as Te}from"./building-2-Ckg-FmN9.js";import{R as Be}from"./refresh-cw-FCIZnuDU.js";import{M as Oe}from"./map-pin-DbAZafho.js";import{E as ke}from"./eye-6Y9sbcRx.js";import{C as ze}from"./circle-check-big-D7qwqCjm.js";import{C as Ee}from"./circle-x-B7c9D1w4.js";import"./chevron-down-BIP_RoMW.js";import"./check-CrQWtsni.js";function ls({onStatsUpdate:C}){const{token:A}=we(),[x,G]=a.useState([]),[ne,K]=a.useState(!0),[b,Y]=a.useState(""),[w,Z]=a.useState("all"),[P,U]=a.useState("all"),[D,ee]=a.useState("all"),[M,se]=a.useState("all"),[I,te]=a.useState("applied_at"),[R,ae]=a.useState("desc"),[t,g]=a.useState(null),[ce,re]=a.useState(!1),[oe,F]=a.useState(!1),[de,f]=a.useState(!1),[T,$]=a.useState(""),[B,O]=a.useState(!1),[pe,he]=a.useState([]),[k,xe]=a.useState(0),[o,q]=a.useState(1),[N]=a.useState(50),[i,d]=a.useState({start_date:"",department:"",position:"",pay_rate:"",employment_type:"full-time"}),me=async()=>{try{const s=await E.get("/api/hr/properties",{headers:{Authorization:`Bearer ${A}`}}),c=s.data.data||s.data;he(Array.isArray(c)?c:[])}catch(s){console.error("Error fetching properties:",s)}},m=async()=>{try{K(!0);const s=new URLSearchParams;P!=="all"&&s.append("property_id",P),w!=="all"&&s.append("status",w),D!=="all"&&s.append("department",D),M!=="all"&&s.append("position",M),b&&s.append("search",b),s.append("sort_by",I),s.append("sort_order",R),s.append("limit",N.toString()),s.append("offset",((o-1)*N).toString());const c=await E.get(`/api/hr/applications/all?${s.toString()}`,{headers:{Authorization:`Bearer ${A}`}});G(c.data.applications||[]),xe(c.data.total||0)}catch(s){console.error("Error fetching system applications:",s),G([])}finally{K(!1)}};a.useEffect(()=>{m(),me()},[b,w,P,D,M,I,R,o]),a.useEffect(()=>{const s=setInterval(()=>{m()},3e4);return()=>clearInterval(s)},[]);const je=a.useMemo(()=>[...new Set(x.map(s=>s.department).filter(Boolean))].sort(),[x]),ue=a.useMemo(()=>[...new Set(x.map(s=>s.position).filter(Boolean))].sort(),[x]),ve=()=>{Y(""),Z("all"),U("all"),ee("all"),se("all"),te("applied_at"),ae("desc"),q(1)},ye=async()=>{var s,c;if(t){if(t.status!=="pending"){alert("This application is no longer pending."),m(),f(!1);return}try{O(!0),await E.post(`/applications/${t.id}/approve-enhanced`,{...i,send_email:!0},{headers:{Authorization:`Bearer ${A}`}}),await m(),C&&C(),f(!1),g(null),d({start_date:"",department:"",position:"",pay_rate:"",employment_type:"full-time"})}catch(_){console.error("Error approving application:",_),alert(((c=(s=_.response)==null?void 0:s.data)==null?void 0:c.detail)||"Failed to approve application")}finally{O(!1)}}},ge=async()=>{var s,c;if(!(!t||!T.trim()))try{O(!0),await E.post(`/applications/${t.id}/reject-enhanced`,{reason:T,add_to_talent_pool:!1},{headers:{Authorization:`Bearer ${A}`}}),await m(),C&&C(),F(!1),g(null),$("")}catch(_){console.error("Error rejecting application:",_),alert(((c=(s=_.response)==null?void 0:s.data)==null?void 0:c.detail)||"Failed to reject application")}finally{O(!1)}},fe=s=>{g(s),re(!0)},Ne=s=>{g(s),d({start_date:"",department:s.department,position:s.position,pay_rate:"",employment_type:"full-time"}),f(!0)},_e=s=>{g(s),$(""),F(!0)},le=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"talent_pool":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},L=Math.ceil(k/N);return e.jsxs(Se,{children:[e.jsx(Ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"System-Wide Applications",e.jsxs(z,{variant:"secondary",children:[k," Total"]})]}),e.jsxs(n,{onClick:m,variant:"outline",size:"sm",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})}),e.jsxs(be,{children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Pe,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(S,{placeholder:"Search by name, email...",value:b,onChange:s=>Y(s.target.value),className:"pl-10"})]}),e.jsxs(j,{value:P,onValueChange:U,children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(v,{placeholder:"All Properties"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All Properties"}),pe.map(s=>e.jsx(r,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(j,{value:w,onValueChange:Z,children:[e.jsx(u,{className:"w-[150px]",children:e.jsx(v,{placeholder:"All Status"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"approved",children:"Approved"}),e.jsx(r,{value:"rejected",children:"Rejected"}),e.jsx(r,{value:"talent_pool",children:"Talent Pool"})]})]}),e.jsx(n,{variant:"outline",size:"sm",onClick:ve,children:"Clear Filters"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{value:D,onValueChange:ee,children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(v,{placeholder:"All Departments"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All Departments"}),je.map(s=>e.jsx(r,{value:s,children:s},s))]})]}),e.jsxs(j,{value:M,onValueChange:se,children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(v,{placeholder:"All Positions"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All Positions"}),ue.map(s=>e.jsx(r,{value:s,children:s},s))]})]}),e.jsxs(j,{value:I,onValueChange:te,children:[e.jsx(u,{className:"w-[150px]",children:e.jsx(v,{placeholder:"Sort By"})}),e.jsxs(y,{children:[e.jsx(r,{value:"applied_at",children:"Applied Date"}),e.jsx(r,{value:"name",children:"Name"}),e.jsx(r,{value:"status",children:"Status"}),e.jsx(r,{value:"property",children:"Property"})]})]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>ae(R==="asc"?"desc":"asc"),children:R==="asc"?"↑":"↓"})]})]}),ne?e.jsx("div",{className:"text-center py-8",children:"Loading applications..."}):x.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No applications found matching your filters."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(De,{children:[e.jsx(Me,{children:e.jsxs(ie,{children:[e.jsx(p,{children:"Property"}),e.jsx(p,{children:"Applicant"}),e.jsx(p,{children:"Department"}),e.jsx(p,{children:"Position"}),e.jsx(p,{children:"Applied"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(Re,{children:x.map(s=>e.jsxs(ie,{children:[e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.property_name}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(Oe,{className:"h-3 w-3"}),s.property_city,", ",s.property_state]}),!s.property_active&&e.jsx(z,{variant:"outline",className:"text-xs",children:"Inactive"})]})}),e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.applicant_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.applicant_email}),s.applicant_phone&&e.jsx("div",{className:"text-sm text-gray-500",children:s.applicant_phone})]})}),e.jsx(h,{children:s.department}),e.jsx(h,{children:s.position}),e.jsx(h,{children:W(X(s.applied_at),"MMM d, yyyy")}),e.jsx(h,{children:e.jsx(z,{className:le(s.status),children:s.status==="talent_pool"?"Talent Pool":s.status})}),e.jsx(h,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",onClick:()=>fe(s),children:e.jsx(ke,{className:"h-4 w-4"})}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{size:"sm",variant:"outline",className:"text-green-600",onClick:()=>Ne(s),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx(n,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>_e(s),children:e.jsx(Ee,{className:"h-4 w-4"})})]})]})})]},s.id))})]})}),L>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(o-1)*N+1," to ",Math.min(o*N,k)," of ",k," applications"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>q(o-1),disabled:o===1,children:"Previous"}),e.jsxs("span",{className:"flex items-center px-3 text-sm",children:["Page ",o," of ",L]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>q(o+1),disabled:o===L,children:"Next"})]})]})]}),e.jsx(V,{open:ce,onOpenChange:re,children:e.jsxs(H,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Q,{children:e.jsx(J,{children:"Application Details"})}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Property"}),e.jsx("div",{className:"font-medium",children:t.property_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.property_city,", ",t.property_state]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Status"}),e.jsx(z,{className:le(t.status),children:t.status})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Department"}),e.jsx("div",{children:t.department})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Position"}),e.jsx("div",{children:t.position})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Applied Date"}),e.jsx("div",{children:W(X(t.applied_at),"MMMM d, yyyy h:mm a")})]}),t.reviewed_at&&e.jsxs("div",{children:[e.jsx(l,{children:"Reviewed Date"}),e.jsx("div",{children:W(X(t.reviewed_at),"MMMM d, yyyy h:mm a")})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Applicant Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Name"}),e.jsx("div",{children:t.applicant_name})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Email"}),e.jsx("div",{children:t.applicant_email})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Phone"}),e.jsx("div",{children:t.applicant_phone||"N/A"})]})]})]}),t.notes&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(l,{children:"Notes"}),e.jsx("div",{className:"mt-1",children:t.notes})]})]})]})}),e.jsx(V,{open:de,onOpenChange:f,children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsx(J,{children:"Approve Application"})}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Approving application for: ",e.jsx("strong",{children:t.applicant_name})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Property: ",e.jsx("strong",{children:t.property_name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"start_date",children:"Start Date"}),e.jsx(S,{id:"start_date",type:"date",value:i.start_date,onChange:s=>d({...i,start_date:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"pay_rate",children:"Pay Rate"}),e.jsx(S,{id:"pay_rate",type:"text",placeholder:"e.g., $15/hour",value:i.pay_rate,onChange:s=>d({...i,pay_rate:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"department",children:"Department"}),e.jsx(S,{id:"department",type:"text",value:i.department,onChange:s=>d({...i,department:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"position",children:"Position"}),e.jsx(S,{id:"position",type:"text",value:i.position,onChange:s=>d({...i,position:s.target.value}),required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{htmlFor:"employment_type",children:"Employment Type"}),e.jsxs(j,{value:i.employment_type,onValueChange:s=>d({...i,employment_type:s}),children:[e.jsx(u,{children:e.jsx(v,{})}),e.jsxs(y,{children:[e.jsx(r,{value:"full-time",children:"Full-time"}),e.jsx(r,{value:"part-time",children:"Part-time"}),e.jsx(r,{value:"seasonal",children:"Seasonal"}),e.jsx(r,{value:"temporary",children:"Temporary"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(n,{onClick:ye,disabled:B||!i.start_date||!i.pay_rate,children:B?"Approving...":"Approve & Send Offer"})]})]})]})}),e.jsx(V,{open:oe,onOpenChange:F,children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsx(J,{children:"Reject Application"})}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Rejecting application for: ",e.jsx("strong",{children:t.applicant_name})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Property: ",e.jsx("strong",{children:t.property_name})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"rejection_reason",children:"Rejection Reason"}),e.jsx(Fe,{id:"rejection_reason",value:T,onChange:s=>$(s.target.value),placeholder:"Please provide a reason for rejection...",rows:4,required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:ge,disabled:B||!T.trim(),children:B?"Rejecting...":"Reject Application"})]})]})]})})]})]})}export{ls as SystemApplicationsTab};
