import{j as e}from"./radixUI-MBKqlelr.js";import{u as ne,f as ie,a as r,O as ce}from"./vendor-BQUE8CnD.js";import{u as le,a as de,T as F,B as w,A as pe,b as me}from"./index-BX3Jf5rY.js";import{C as x,a as g}from"./card-0UsC1Hfx.js";import{u as he,a as xe,b as ge,H as ue,E as be,S as ye,D as Ne}from"./use-websocket-F1Sx5ftU.js";import{D as je}from"./breadcrumb-LLTWqxPN.js";import{a as q}from"./utils-Co3JUx4V.js";import{A as G}from"./activity-C1A2Z62K.js";import{R as fe}from"./refresh-cw-FCIZnuDU.js";import"./home-ClFiBZK5.js";import"./badge-DbL2e8Dt.js";import"./building-2-Ckg-FmN9.js";import"./user-check-kaC5-dJg.js";import"./users-DJfJLhR6.js";import"./file-text-lgpzM1Mh.js";import"./bar-chart-3-B6uS4aOV.js";import"./chevron-down-BIP_RoMW.js";import"./chevron-right-D20CZ_0W.js";function We(){const{user:t,logout:v,loading:D}=le(),{error:R,success:y,info:S}=de(),A=ne(),k=ie(),_=he({role:"hr"}),{trackNavigation:J}=xe(),[n,V]=r.useState({totalProperties:0,totalManagers:0,totalEmployees:0,pendingApplications:0}),[K,E]=r.useState(!0),[N,C]=r.useState(null),[H,Q]=r.useState(0),[X,Y]=r.useState(!1),[M,$]=r.useState(!1),[Z,p]=r.useState(new Date),[T,L]=r.useState(null),[P,ee]=r.useState([]),{isConnected:I,connectionError:ae}=ge("ws://localhost:8000/ws/dashboard",{enabled:!!t&&t.role==="hr",onMessage:a=>{var i,m,o,c,h,u,O,W,U,z,B;try{const s=JSON.parse(a.data);console.log("[HR Dashboard] WebSocket message:",s);const d=(f,b)=>{ee(oe=>[{type:f,message:b,timestamp:new Date},...oe.slice(0,4)])};switch(s.type){case"application_created":case"new_application":console.log("[HR Dashboard] New application received:",s.data),l("New application received"),S("New Application",`New application at ${((i=s.data)==null?void 0:i.property_name)||"a property"}`),d("application",`New application at ${((m=s.data)==null?void 0:m.property_name)||"property"}`),p(new Date);break;case"application_approved":case"application_rejected":case"application_status_change":console.log("[HR Dashboard] Application status changed:",s.data),l("Application status updated");const f=`Application ${((o=s.data)==null?void 0:o.status)||"updated"} at ${((c=s.data)==null?void 0:c.property_name)||"property"}`;d("status",f),p(new Date);break;case"manager_assigned":console.log("[HR Dashboard] Manager assigned:",s.data),l("Manager assignment updated"),S("Manager Assigned",`New manager assigned to ${((h=s.data)==null?void 0:h.property_name)||"property"}`),d("manager",`Manager assigned to ${((u=s.data)==null?void 0:u.property_name)||"property"}`),p(new Date);break;case"property_created":case"property_updated":case"property_deleted":console.log("[HR Dashboard] Property changed:",s.data),l("Property data updated");const b=s.type==="property_created"?"New property created":"Property updated";y("Property Update",`${b}: ${((O=s.data)==null?void 0:O.name)||"Property"}`),d("property",b),p(new Date);break;case"onboarding_completed":console.log("[HR Dashboard] Onboarding completed:",s.data),l("Employee onboarding completed"),y("Onboarding Complete",`Employee completed onboarding at ${((W=s.data)==null?void 0:W.property_name)||"property"}`),d("onboarding",`Onboarding completed at ${((U=s.data)==null?void 0:U.property_name)||"property"}`),p(new Date);break;case"compliance_alert":console.log("[HR Dashboard] Compliance alert:",s.data),R("Compliance Alert",((z=s.data)==null?void 0:z.message)||"Compliance issue detected"),d("alert",((B=s.data)==null?void 0:B.message)||"Compliance issue"),l("Compliance check required");break;default:console.log("[HR Dashboard] Unknown event type:",s.type)}}catch(s){console.error("[HR Dashboard] Failed to parse WebSocket message:",s)}},onOpen:()=>{console.log("[HR Dashboard] WebSocket connected")},onClose:a=>{console.log("[HR Dashboard] WebSocket disconnected:",a.code,a.reason)},onError:a=>{console.error("[HR Dashboard] WebSocket error:",a)}});r.useEffect(()=>{},[I,ae]),r.useEffect(()=>{const a=()=>{Y(window.innerWidth<768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const se=_.currentSection;r.useEffect(()=>{!D&&t&&j()},[H,D,t]),r.useEffect(()=>{A.pathname==="/hr"&&k("/hr/overview",{replace:!0})},[A.pathname,k]);const j=async(a=!1)=>{var i,m;try{a?$(!0):E(!0),C(null);const c={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},h=await q.get("/api/hr/dashboard-stats",c),u=h.data.data||h.data;V(u),H>0&&y("Dashboard refreshed","Stats have been updated successfully")}catch(o){console.error("Failed to fetch dashboard stats:",o);const c=q.isAxiosError(o)?((m=(i=o.response)==null?void 0:i.data)==null?void 0:m.detail)||o.message:"Failed to load dashboard statistics";C(c),R("Failed to load dashboard",c)}finally{E(!1),$(!1)}},l=async a=>{a&&(L(a),setTimeout(()=>L(null),3e3)),await j(!0)},te=()=>{Q(a=>a+1)};if((t==null?void 0:t.role)!=="hr")return e.jsx("div",{className:"responsive-container padding-lg flex items-center justify-center min-h-screen",children:e.jsx(x,{className:"card-elevated card-rounded-lg max-w-md w-full",children:e.jsxs(g,{className:"card-padding-lg text-center spacing-sm",children:[e.jsx(F,{className:"h-12 w-12 text-amber-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-heading-lg text-primary mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-body-md text-secondary mb-6",children:"HR role required to access this dashboard."}),e.jsx(w,{onClick:v,className:"",children:"Return to Login"})]})})});const re=ue.map(a=>({...a,badge:a.key==="applications"&&n.pendingApplications>0?n.pendingApplications:void 0}));return e.jsx(be,{children:e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"responsive-container padding-md",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"spacing-xs",children:[e.jsx("h1",{className:"text-display-md",children:"HR Dashboard"}),e.jsxs("p",{className:"text-body-md text-secondary",children:["Welcome, ",t!=null&&t.first_name&&(t!=null&&t.last_name)?`${t.first_name} ${t.last_name}`:t==null?void 0:t.email]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Role: HR Administrator"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[!1,T&&e.jsxs("div",{className:"flex items-center gap-2 animate-slide-in",children:[e.jsx(G,{className:"h-3 w-3 text-blue-500 animate-pulse"}),e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:T})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[N&&e.jsxs(w,{onClick:te,variant:"outline",size:"sm",className:"",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Retry"]}),e.jsx(w,{onClick:v,variant:"outline",className:"",children:"Logout"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(je,{role:"hr",currentSection:se})}),N&&e.jsxs(pe,{variant:"destructive",className:"mb-6 animate-slide-down",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx(me,{children:N})]}),I&&P.length>0&&e.jsxs("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4 animate-slide-down",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Recent Activity"})]}),e.jsx("div",{className:"space-y-1",children:P.map((a,i)=>e.jsxs("div",{className:"text-xs text-blue-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"â€¢"}),e.jsx("span",{children:a.message}),e.jsx("span",{className:"text-blue-400 ml-auto",children:new Date(a.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]},i))})]}),e.jsx("div",{className:`mb-8 transition-opacity duration-300 ${M?"opacity-70":"opacity-100"}`,children:K?e.jsx(ye,{count:4}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(x,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(g,{className:"p-6 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:n.totalProperties}),e.jsx("p",{className:"text-sm text-gray-500",children:"Properties"})]})})}),e.jsx(x,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(g,{className:"p-6 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:n.totalManagers}),e.jsx("p",{className:"text-sm text-gray-500",children:"Managers"})]})})}),e.jsx(x,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(g,{className:"p-6 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:n.totalEmployees}),e.jsx("p",{className:"text-sm text-gray-500",children:"Employees"})]})})}),e.jsx(x,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(g,{className:"p-6 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:n.pendingApplications}),e.jsx("p",{className:"text-sm text-gray-500",children:"Pending Applications"})]})})})]})}),e.jsx("div",{className:"mb-6",children:e.jsx(Ne,{items:re,userRole:"hr",className:"w-full",variant:X?"mobile":"tabs",showLabels:!0,compact:!1,orientation:"horizontal",onNavigate:a=>{J(_.currentSection,a.key)}})}),e.jsx("div",{className:"spacing-md",children:e.jsx(ce,{context:{stats:n,onStatsUpdate:j,lastUpdateTime:Z,isRefreshing:M,userRole:"hr"}})})]})})})}export{We as HRDashboardLayout};
