import{j as e}from"./radixUI-MBKqlelr.js";import{a as l}from"./vendor-BQUE8CnD.js";import{C as F,a as T,b as Te,c as Ee}from"./card-0UsC1Hfx.js";import{d as le,a as Le,c as f,B as d,A as ke,T as Oe,b as Ie}from"./index-BX3Jf5rY.js";import{I as g}from"./input-C7n7UaRv.js";import{L as m}from"./label-BGHhm9HA.js";import{B as E}from"./badge-DbL2e8Dt.js";import{S as L,a as k,b as O,c as I,d as x}from"./select-CHEqtOpE.js";import{D as R,a as Re,b as B,c as U,d as V,e as X,f as te}from"./dialog-BrcI6BMt.js";import{S as Be,A as Ue,h as Ve,a as qe,b as He,c as ze,d as $e,e as Ye,f as We,g as Xe}from"./alert-dialog-CpHvPefG.js";import{S as Ge,T as Je,a as Ke,b as re,c as C,d as Qe,e as b}from"./table-B6NKxQYn.js";import{U as Ze}from"./users-DJfJLhR6.js";import{B as G}from"./building-D7pk8e3U.js";import{P as es}from"./plus-_zwNWoy_.js";import{U as ss}from"./user-BSKbQLbH.js";import{U as as}from"./user-x-CFS4ZwId.js";import{R as ts}from"./refresh-cw-FCIZnuDU.js";import{C as ie}from"./circle-check-big-D7qwqCjm.js";import{C as rs}from"./copy-Bygxza59.js";import"./utils-Co3JUx4V.js";import"./chevron-down-BIP_RoMW.js";import"./check-CrQWtsni.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=le("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=le("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);function Ds({onStatsUpdate:S=()=>{}}){const[v,ne]=l.useState([]),[p,J]=l.useState([]),[oe,ce]=l.useState(!0),[o,K]=l.useState(!0),[w,de]=l.useState(""),[N,me]=l.useState("all"),[j,pe]=l.useState(!1),[he,q]=l.useState(!1),[M,Q]=l.useState(null),[xe,P]=l.useState(!1),[ge,H]=l.useState(!1),[Z,je]=l.useState(""),[ue,fe]=l.useState(""),[ee,z]=l.useState(!1),[ye,D]=l.useState(!1),[c,se]=l.useState(null),[A,$]=l.useState(""),{toast:n}=Le(),[a,h]=l.useState({email:"",first_name:"",last_name:"",property_id:"",password:""});l.useEffect(()=>{y(),ve()},[j]),l.useEffect(()=>{v.forEach(s=>{we(s.id)})},[v]);const y=async()=>{try{const s=await f.hr.getManagers(j?{include_inactive:!0}:{}),i=(Array.isArray(s.data)?s.data:[]).map(t=>({id:t.id,email:t.email,first_name:t.first_name,last_name:t.last_name,role:"manager",properties:Array.isArray(t.properties)?t.properties:[],is_active:t.is_active!==void 0?t.is_active:!0,created_at:t.created_at}));console.log("Transformed managers:",i),ne(i)}catch(s){console.error("Failed to fetch managers:",s),n({title:"Error",description:"Failed to fetch managers",variant:"destructive"})}finally{ce(!1)}},ve=async()=>{K(!0);try{const s=await f.hr.getProperties();J(Array.isArray(s.data)?s.data:[])}catch(s){console.error("Failed to fetch properties:",s),n({title:"Warning",description:"Failed to load properties. Property assignment may not work properly.",variant:"destructive"}),J([])}finally{K(!1)}},we=async s=>{},Ne=async s=>{var r,i;if(s.preventDefault(),!a.email||!a.first_name||!a.last_name){n({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}try{const t={email:a.email,first_name:a.first_name,last_name:a.last_name};a.password&&(t.password=a.password),a.property_id&&a.property_id!=="none"&&(t.property_id=a.property_id);const u=(await f.hr.createManager(t)).data;u!=null&&u.temporary_password?(je(u.temporary_password),fe(u.email),z(!1),H(!0)):n({title:"Success",description:"Manager created successfully"}),q(!1),h({email:"",first_name:"",last_name:"",property_id:"",password:""}),y(),S()}catch(t){n({title:"Error",description:((i=(r=t.response)==null?void 0:r.data)==null?void 0:i.detail)||"Failed to create manager",variant:"destructive"})}},_e=async s=>{var r,i;if(s.preventDefault(),!!M)try{const t=new FormData;console.log("Editing manager:",M.id),console.log("Form data:",a),console.log("Original manager data:",M),a.email&&t.append("email",a.email),a.first_name&&t.append("first_name",a.first_name),a.last_name&&t.append("last_name",a.last_name);const _=a.property_id==="none"?"":a.property_id;t.append("property_id",_||""),console.log("Sending property_id:",_);for(let[Y,W]of t.entries())console.log(`FormData ${Y}:`,W);const u={};for(let[Y,W]of t.entries())u[Y]=W;const Fe=await f.hr.updateManager(M.id,u);console.log("Update response:",Fe.data),n({title:"Success",description:"Manager updated successfully"}),P(!1),Q(null),h({email:"",first_name:"",last_name:"",property_id:"",password:""}),y(),S()}catch(t){n({title:"Error",description:((i=(r=t.response)==null?void 0:r.data)==null?void 0:i.detail)||"Failed to update manager",variant:"destructive"})}},Ce=async s=>{var r,i;try{await f.hr.deleteManager(s),n({title:"Success",description:"Manager deactivated successfully"}),y(),S()}catch(t){n({title:"Error",description:((i=(r=t.response)==null?void 0:r.data)==null?void 0:i.detail)||"Failed to deactivate manager",variant:"destructive"})}},be=async s=>{var r,i;try{await f.hr.reactivateManager(s),n({title:"Success",description:"Manager reactivated successfully"}),y(),S()}catch(t){n({title:"Error",description:((i=(r=t.response)==null?void 0:r.data)==null?void 0:i.detail)||"Failed to reactivate manager",variant:"destructive"})}},Se=()=>{navigator.clipboard.writeText(Z).then(()=>{z(!0),n({title:"Password Copied",description:"The temporary password has been copied to your clipboard"}),setTimeout(()=>z(!1),3e3)}).catch(()=>{n({title:"Error",description:"Failed to copy password to clipboard",variant:"destructive"})})},Me=async()=>{var s,r;if(!(!c||!A))try{await f.hr.assignManager(c.id,A),n({title:"Success",description:"Property assigned successfully"}),D(!1),se(null),$(""),y()}catch(i){n({title:"Error",description:((r=(s=i.response)==null?void 0:s.data)==null?void 0:r.detail)||"Failed to assign property",variant:"destructive"})}},Pe=async(s,r)=>{var i,t;try{await f.hr.removeManagerFromProperty(r,s),n({title:"Success",description:"Property removed successfully"}),y()}catch(_){n({title:"Error",description:((t=(i=_.response)==null?void 0:i.data)==null?void 0:t.detail)||"Failed to remove property",variant:"destructive"})}},De=s=>{var i,t;console.log("Opening edit dialog for manager:",s),console.log("Manager properties:",s.properties),console.log("Available properties:",p),Q(s);const r={email:s.email,first_name:s.first_name||"",last_name:s.last_name||"",property_id:((t=(i=s.properties)==null?void 0:i[0])==null?void 0:t.id)||"none",password:""};console.log("Setting initial form data:",r),h(r),P(!0)},Ae=s=>{se(s),$(""),D(!0)},ae=v.filter(s=>{const r=s.email.toLowerCase().includes(w.toLowerCase())||`${s.first_name} ${s.last_name}`.toLowerCase().includes(w.toLowerCase())||s.properties.some(t=>t.name.toLowerCase().includes(w.toLowerCase())),i=N==="all"||N==="unassigned"&&s.properties.length===0||s.properties.some(t=>t.id===N);return r&&i});return oe?e.jsx(F,{children:e.jsx(T,{className:"p-6",children:e.jsx("div",{className:"text-center",children:"Loading managers..."})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(F,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ze,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Managers"}),e.jsx("p",{className:"text-2xl font-bold",children:v.length})]})]})})}),e.jsx(F,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Managers with Properties"}),e.jsx("p",{className:"text-2xl font-bold",children:v.filter(s=>s.properties&&s.properties.length>0).length})]})]})})})]}),e.jsxs(F,{children:[e.jsx(Te,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Ee,{children:"Managers Management"}),e.jsxs(R,{open:he,onOpenChange:q,children:[e.jsx(Re,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"Add Manager"]})}),e.jsxs(B,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"Create New Manager"}),e.jsx(X,{children:"Add a new manager to the system. You can optionally assign them to a property."})]}),e.jsxs("form",{onSubmit:Ne,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"first_name",children:"First Name *"}),e.jsx(g,{id:"first_name",value:a.first_name,onChange:s=>h({...a,first_name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(g,{id:"last_name",value:a.last_name,onChange:s=>h({...a,last_name:s.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"email",children:"Email *"}),e.jsx(g,{id:"email",type:"email",value:a.email,onChange:s=>h({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"password",children:"Password (Optional)"}),e.jsx(g,{id:"password",type:"password",value:a.password,onChange:s=>h({...a,password:s.target.value}),placeholder:"Leave blank to auto-generate"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"If left blank, a temporary password will be generated"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"property_id",children:"Assign to Property"}),e.jsxs(L,{value:a.property_id,onValueChange:s=>h({...a,property_id:s}),disabled:o,children:[e.jsx(k,{children:e.jsx(O,{placeholder:o?"Loading properties...":p.length===0?"No properties available":"Select a property (optional)"})}),e.jsxs(I,{children:[e.jsx(x,{value:"none",children:"No assignment"}),p.length===0&&!o?e.jsx(x,{value:"no-properties",disabled:!0,children:"No properties available - Create a property first"}):p.map(s=>e.jsxs(x,{value:s.id,children:[s.name," - ",s.city,", ",s.state]},s.id))]})]}),p.length===0&&!o&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Create properties first to assign managers to them."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsx(d,{type:"submit",children:"Create Manager"})]})]})]})]})]})}),e.jsxs(T,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Show Inactive Managers"}),e.jsxs("button",{onClick:()=>pe(!j),className:"flex items-center space-x-2 px-3 py-1 rounded-md transition-colors",style:{backgroundColor:j?"#3b82f6":"#e5e7eb",color:j?"white":"#6b7280"},children:[j?e.jsx(ls,{className:"h-5 w-5"}):e.jsx(is,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:j?"ON":"OFF"})]})]}),e.jsx("div",{className:"text-sm text-gray-600",children:j?"Showing all managers":"Showing only active managers"})]}),e.jsxs("div",{className:"flex space-x-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(g,{placeholder:"Search managers by name, email, or property...",value:w,onChange:s=>de(s.target.value),className:"pl-10"})]})}),e.jsxs(L,{value:N,onValueChange:me,disabled:o,children:[e.jsx(k,{className:"w-48",children:e.jsx(O,{placeholder:o?"Loading...":"Filter by property"})}),e.jsxs(I,{children:[e.jsx(x,{value:"all",children:"All Properties"}),e.jsx(x,{value:"unassigned",children:"Unassigned"}),p.length===0&&!o?e.jsx(x,{value:"no-properties",disabled:!0,children:"No properties available"}):p.map(s=>e.jsx(x,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-x-auto",children:[e.jsxs(Je,{children:[e.jsx(Ke,{children:e.jsxs(re,{children:[e.jsx(C,{className:"whitespace-nowrap",children:"Manager"}),e.jsx(C,{className:"whitespace-nowrap",children:"Email"}),e.jsx(C,{className:"whitespace-nowrap",children:"Property"}),e.jsx(C,{className:"whitespace-nowrap",children:"Status"}),e.jsx(C,{className:"whitespace-nowrap",children:"Actions"})]})}),e.jsx(Qe,{children:ae.map(s=>e.jsxs(re,{className:s.is_active?"":"bg-gray-50 opacity-75",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ss,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Created ",new Date(s.created_at).toLocaleDateString()]})]})]})}),e.jsx(b,{children:s.email}),e.jsx(b,{children:s.properties&&s.properties.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:s.properties.map(r=>e.jsxs(E,{variant:"secondary",className:"text-xs",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),r.name]},r.id))}):e.jsx(E,{variant:"outline",children:"Unassigned"})}),e.jsx(b,{children:e.jsx(E,{variant:"outline",className:s.is_active?"bg-green-100 text-green-800 border-green-200":"bg-gray-100 text-gray-800 border-gray-200",children:s.is_active?"ACTIVE":"INACTIVE"})}),e.jsx(b,{className:"whitespace-nowrap",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>De(s),title:"Edit Manager",children:e.jsx(Be,{className:"h-4 w-4"})}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ae(s),title:"Assign Property",children:e.jsx(G,{className:"h-4 w-4"})}),e.jsxs(Ue,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(d,{variant:"outline",size:"sm",title:"Deactivate Manager",children:e.jsx(as,{className:"h-4 w-4"})})}),e.jsxs(qe,{children:[e.jsxs(He,{children:[e.jsx(ze,{children:"Deactivate Manager"}),e.jsxs($e,{children:["Are you sure you want to deactivate ",s.first_name," ",s.last_name,"? They will lose access to the system. You can reactivate them later if needed."]})]}),e.jsxs(Ye,{children:[e.jsx(We,{children:"Cancel"}),e.jsx(Xe,{onClick:()=>Ce(s.id),className:"bg-orange-600 hover:bg-orange-700",children:"Deactivate"})]})]})]})]}):e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>be(s.id),title:"Reactivate Manager",className:"text-green-600 hover:text-green-700",children:[e.jsx(ts,{className:"h-4 w-4 mr-1"}),"Reactivate"]})})})]},s.id))})]}),ae.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:w||N!=="all"?"No managers found matching your criteria":"No managers found. Create your first manager to get started."})]})]})]}),e.jsx(R,{open:ge,onOpenChange:H,children:e.jsxs(B,{className:"max-w-lg",children:[e.jsx(U,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-green-500"}),"Manager Created Successfully!"]})}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs(ke,{className:"border-amber-200 bg-amber-50",children:[e.jsx(Oe,{className:"h-4 w-4 text-amber-600"}),e.jsxs(Ie,{className:"text-amber-900",children:[e.jsx("strong",{children:"Important:"})," Please save this password. It will not be shown again. The manager must change this password on first login."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(m,{className:"text-sm text-gray-600",children:"Email:"}),e.jsx("span",{className:"font-medium",children:ue})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-sm text-gray-600",children:"Temporary Password:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{value:Z,readOnly:!0,className:"font-mono bg-gray-50",type:"text"}),e.jsx(d,{variant:"outline",onClick:Se,className:ee?"bg-green-50":"",children:ee?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4 mr-2 text-green-600"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Copy"]})})]})]})]})]}),e.jsx(te,{className:"mt-6",children:e.jsx(d,{onClick:()=>H(!1),children:"Close"})})]})}),e.jsx(R,{open:ye,onOpenChange:D,children:e.jsxs(B,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"Assign Property to Manager"}),e.jsxs(X,{children:["Select a property to assign to ",c==null?void 0:c.first_name," ",c==null?void 0:c.last_name]})]}),c&&e.jsxs("div",{className:"space-y-4 mt-4",children:[c.properties.length>0&&e.jsxs("div",{children:[e.jsx(m,{className:"text-sm text-gray-600",children:"Currently Assigned:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:c.properties.map(s=>e.jsxs(E,{variant:"secondary",children:[s.name,e.jsx("button",{onClick:()=>Pe(c.id,s.id),className:"ml-2 text-red-500 hover:text-red-700",title:"Remove property",children:"×"})]},s.id))})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"assign_property",children:"Select Property to Add"}),e.jsxs(L,{value:A,onValueChange:$,disabled:o,children:[e.jsx(k,{children:e.jsx(O,{placeholder:o?"Loading properties...":"Select a property"})}),e.jsx(I,{children:p.filter(s=>!c.properties.some(r=>r.id===s.id)).map(s=>e.jsxs(x,{value:s.id,children:[s.name," - ",s.city,", ",s.state]},s.id))})]})]})]}),e.jsxs(te,{className:"mt-6",children:[e.jsx(d,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),e.jsx(d,{onClick:Me,disabled:!A,children:"Assign Property"})]})]})}),e.jsx(R,{open:xe,onOpenChange:P,children:e.jsxs(B,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"Edit Manager"}),e.jsx(X,{children:"Update manager information and property assignments."})]}),e.jsxs("form",{onSubmit:_e,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit_first_name",children:"First Name"}),e.jsx(g,{id:"edit_first_name",value:a.first_name,onChange:s=>h({...a,first_name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit_last_name",children:"Last Name"}),e.jsx(g,{id:"edit_last_name",value:a.last_name,onChange:s=>h({...a,last_name:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit_email",children:"Email"}),e.jsx(g,{id:"edit_email",type:"email",value:a.email,onChange:s=>h({...a,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit_property_id",children:"Property Assignment"}),e.jsxs(L,{value:a.property_id,onValueChange:s=>h({...a,property_id:s}),disabled:o,children:[e.jsx(k,{children:e.jsx(O,{placeholder:o?"Loading properties...":p.length===0?"No properties available":"Select a property"})}),e.jsxs(I,{children:[e.jsx(x,{value:"none",children:"No assignment"}),p.length===0&&!o?e.jsx(x,{value:"no-properties",disabled:!0,children:"No properties available - Create a property first"}):p.map(s=>e.jsxs(x,{value:s.id,children:[s.name," - ",s.city,", ",s.state]},s.id))]})]}),p.length===0&&!o&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Create properties first to assign managers to them."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancel"}),e.jsx(d,{type:"submit",children:"Update Manager"})]})]})]})})]})}export{Ds as default};
