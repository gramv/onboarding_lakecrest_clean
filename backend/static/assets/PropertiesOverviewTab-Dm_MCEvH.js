import{j as e}from"./radixUI-MBKqlelr.js";import{a as i}from"./vendor-BQUE8CnD.js";import{C as o,b as k,c as E,a as l}from"./card-0UsC1Hfx.js";import{I as Z}from"./input-C7n7UaRv.js";import{B as M}from"./badge-DbL2e8Dt.js";import{S as ee,T as se,a as te,b as N,c as m,d as ae,e as c}from"./table-B6NKxQYn.js";import{u as re,a as ie,c as u}from"./index-BX3Jf5rY.js";import{B as ne}from"./building-2-Ckg-FmN9.js";import{U as D}from"./user-check-kaC5-dJg.js";import{U as I}from"./users-DJfJLhR6.js";import{F as U}from"./file-text-lgpzM1Mh.js";import{T as oe}from"./trending-up-DZykrMLX.js";import{B as le}from"./bar-chart-3-B6uS4aOV.js";import{M as ce}from"./map-pin-DbAZafho.js";import{A as de,a as me,b as xe}from"./arrow-up-0Yxd4vbS.js";import"./utils-Co3JUx4V.js";function Ae({onStatsUpdate:B=()=>{}}){const{user:v,loading:w}=re(),[b,F]=i.useState([]),[_,O]=i.useState([]),[j,R]=i.useState({}),[$,C]=i.useState(!0),[d,H]=i.useState(""),[f,V]=i.useState("name"),[g,S]=i.useState("asc"),{toast:z}=ie(),L=b.length,q=_.length,G=Object.values(j).reduce((s,t)=>s+t.total_employees,0),J=Object.values(j).reduce((s,t)=>s+t.total_applications,0),K=Object.values(j).reduce((s,t)=>s+t.pending_applications,0);i.useEffect(()=>{!w&&v&&Q()},[w,v]);const Q=async()=>{try{C(!0),await Promise.all([W(),X(),Y()]),B()}catch(s){console.error("Error fetching overview data:",s),z({title:"Error",description:"Failed to fetch properties overview",variant:"destructive"})}finally{C(!1)}},W=async()=>{try{const s=await u.hr.getProperties();F(Array.isArray(s.data)?s.data:[])}catch(s){console.error("Error fetching properties:",s)}},X=async()=>{try{const s=await u.hr.getManagers(),t=Array.isArray(s.data)?s.data:[];O(t)}catch(s){console.error("Error fetching managers:",s)}},Y=async()=>{try{const s=await u.hr.getProperties(),a=(Array.isArray(s.data)?s.data:[]).map(async n=>{try{const y=await u.hr.getPropertyStats(n.id);return{propertyId:n.id,stats:y.data||{total_applications:0,pending_applications:0,approved_applications:0,total_employees:0,active_employees:0}}}catch(y){return console.error(`Error fetching stats for property ${n.id}:`,y),{propertyId:n.id,stats:{total_applications:0,pending_applications:0,approved_applications:0,total_employees:0,active_employees:0}}}}),r=await Promise.all(a),T={};r.forEach(n=>{T[n.propertyId]=n.stats}),R(T)}catch(s){console.error("Error fetching property stats:",s)}},x=s=>{f===s?S(g==="asc"?"desc":"asc"):(V(s),S("asc"))},h=s=>f!==s?e.jsx(de,{className:"w-4 h-4 ml-1 text-gray-400"}):g==="asc"?e.jsx(me,{className:"w-4 h-4 ml-1 text-blue-600"}):e.jsx(xe,{className:"w-4 h-4 ml-1 text-blue-600"}),P=s=>s.map(t=>{const a=_.find(r=>r.id===t);return a?a.first_name&&a.last_name?`${a.first_name} ${a.last_name}`:a.email:"Unknown"}),p=s=>j[s]||{total_applications:0,pending_applications:0,approved_applications:0,total_employees:0,active_employees:0},A=b.filter(s=>s.name.toLowerCase().includes(d.toLowerCase())||s.city.toLowerCase().includes(d.toLowerCase())||s.state.toLowerCase().includes(d.toLowerCase())||P(s.manager_ids).some(t=>t.toLowerCase().includes(d.toLowerCase()))).sort((s,t)=>{let a,r;switch(f){case"name":a=s.name.toLowerCase(),r=t.name.toLowerCase();break;case"city":a=s.city.toLowerCase(),r=t.city.toLowerCase();break;case"state":a=s.state.toLowerCase(),r=t.state.toLowerCase();break;case"managers":a=s.manager_ids.length,r=t.manager_ids.length;break;case"employees":a=p(s.id).total_employees,r=p(t.id).total_employees;break;case"applications":a=p(s.id).total_applications,r=p(t.id).total_applications;break;default:return 0}return a<r?g==="asc"?-1:1:a>r?g==="asc"?1:-1:0});return $?e.jsx("div",{className:"space-y-6",children:e.jsxs(o,{children:[e.jsx(k,{children:e.jsx(E,{children:"Properties Overview"})}),e.jsx(l,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading properties overview..."})})})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(o,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Properties"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:L})]}),e.jsx(ne,{className:"h-8 w-8 text-blue-500 opacity-50"})]})})}),e.jsx(o,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Managers"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:q})]}),e.jsx(D,{className:"h-8 w-8 text-green-500 opacity-50"})]})})}),e.jsx(o,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:G})]}),e.jsx(I,{className:"h-8 w-8 text-purple-500 opacity-50"})]})})}),e.jsx(o,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Applications"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:J})]}),e.jsx(U,{className:"h-8 w-8 text-orange-500 opacity-50"})]})})}),e.jsx(o,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pending Applications"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:K})]}),e.jsx(oe,{className:"h-8 w-8 text-red-500 opacity-50"})]})})})]}),e.jsxs(o,{children:[e.jsx(k,{children:e.jsxs(E,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Properties Details"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsxs("span",{children:[L," properties total"]})]})]})}),e.jsxs(l,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Z,{placeholder:"Search by property name, location, or manager...",value:d,onChange:s=>H(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(N,{className:"bg-gray-50",children:[e.jsx(m,{className:"font-semibold",children:e.jsxs("button",{className:"flex items-center hover:text-blue-600 transition-colors",onClick:()=>x("name"),children:["Property",h("name")]})}),e.jsx(m,{className:"font-semibold",children:e.jsxs("button",{className:"flex items-center hover:text-blue-600 transition-colors",onClick:()=>x("city"),children:["Location",h("city")]})}),e.jsx(m,{className:"font-semibold",children:e.jsxs("button",{className:"flex items-center hover:text-blue-600 transition-colors",onClick:()=>x("managers"),children:["Managers",h("managers")]})}),e.jsx(m,{className:"font-semibold",children:e.jsxs("button",{className:"flex items-center hover:text-blue-600 transition-colors",onClick:()=>x("employees"),children:["Employees",h("employees")]})}),e.jsx(m,{className:"font-semibold",children:e.jsxs("button",{className:"flex items-center hover:text-blue-600 transition-colors",onClick:()=>x("applications"),children:["Applications",h("applications")]})}),e.jsx(m,{className:"font-semibold",children:"Status"})]})}),e.jsx(ae,{children:A.length===0?e.jsx(N,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-gray-500",children:d?"No properties found matching your search.":"No properties found."})}):A.map(s=>{const t=p(s.id),a=P(s.manager_ids);return e.jsxs(N,{className:"hover:bg-gray-50",children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.id.slice(0,8),"..."]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm",children:[s.city,", ",s.state]}),e.jsx("div",{className:"text-xs text-gray-500",children:s.zip_code})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4 text-gray-400"}),e.jsx("div",{children:a.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a.length}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.slice(0,2).join(", "),a.length>2&&` +${a.length-2}`]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"None"})})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:t.total_employees}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.active_employees," active"]})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:t.total_applications}),t.pending_applications>0&&e.jsxs(M,{variant:"secondary",className:"text-xs",children:[t.pending_applications," pending"]})]})]})}),e.jsx(c,{children:e.jsx(M,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})})]},s.id)})})]})})]})]})]})}export{Ae as default};
