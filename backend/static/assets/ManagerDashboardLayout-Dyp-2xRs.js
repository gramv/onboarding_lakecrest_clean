import{j as e}from"./radixUI-MBKqlelr.js";import{u as ee,f as ae,a as r,O as se}from"./vendor-BQUE8CnD.js";import{u as te,a as re,c as w,T as P,B as v,A as oe,b as ne}from"./index-BX3Jf5rY.js";import{C as l,a as d,b as ie,c as ce}from"./card-0UsC1Hfx.js";import{B as le}from"./badge-DbL2e8Dt.js";import{u as de,a as me,b as pe,M as he,E as xe,c as ge,S as ue,D as be}from"./use-websocket-F1Sx5ftU.js";import{D as fe}from"./breadcrumb-LLTWqxPN.js";import{R as z}from"./refresh-cw-FCIZnuDU.js";import{B as Ne}from"./bell-C8WFU5uD.js";import{B as je}from"./building-2-Ckg-FmN9.js";import{M as ye}from"./map-pin-DbAZafho.js";import{P as we}from"./phone-CsbprQIk.js";import"./utils-Co3JUx4V.js";import"./home-ClFiBZK5.js";import"./user-check-kaC5-dJg.js";import"./users-DJfJLhR6.js";import"./file-text-lgpzM1Mh.js";import"./bar-chart-3-B6uS4aOV.js";import"./chevron-down-BIP_RoMW.js";import"./chevron-right-D20CZ_0W.js";function Ue(){const{user:n,logout:_}=te(),{error:W,success:S,info:D}=re(),M=ee(),u=ae(),k=de({role:"manager"}),{trackNavigation:O}=me(),[s,q]=r.useState(null),[i,F]=r.useState(null),[C,E]=r.useState(!0),[b,A]=r.useState(null),[R,U]=r.useState(0),[$,G]=r.useState(!1),[f,h]=r.useState(0),[T,B]=r.useState(!1),[H,x]=r.useState(new Date),[L,I]=r.useState(null),{isConnected:J,connectionError:V}=pe("ws://localhost:8000/ws/dashboard",{enabled:!!n&&n.role==="manager",onMessage:a=>{var o,m,c;try{const t=JSON.parse(a.data);switch(console.log("[Manager Dashboard] WebSocket message:",t),t.type){case"application_created":case"new_application":console.log("[Manager Dashboard] New application received:",t.data),g("New application received"),D("New Application",`New application from ${((o=t.data)==null?void 0:o.first_name)||"applicant"}`),x(new Date);break;case"application_approved":case"application_rejected":case"application_status_change":console.log("[Manager Dashboard] Application status changed:",t.data),g("Application status updated"),(m=t.data)!=null&&m.requires_review&&h(p=>p+1),x(new Date);break;case"manager_review_needed":console.log("[Manager Dashboard] Manager review needed:",t.data),h(p=>p+1),g("New review required"),D("Review Required","New application requires your review"),x(new Date);break;case"onboarding_completed":console.log("[Manager Dashboard] Onboarding completed:",t.data),g("Employee onboarding completed"),S("Onboarding Complete",`${((c=t.data)==null?void 0:c.employee_name)||"Employee"} has completed onboarding`),x(new Date);break;case"notification":case"notification_created":console.log("[Manager Dashboard] New notification:",t.data),h(p=>p+1);const y=document.querySelector(".notification-bell");y&&(y.classList.add("animate-pulse"),setTimeout(()=>y.classList.remove("animate-pulse"),3e3));break;default:console.log("[Manager Dashboard] Unknown event type:",t.type)}}catch(t){console.error("[Manager Dashboard] Failed to parse WebSocket message:",t)}},onOpen:()=>{console.log("[Manager Dashboard] WebSocket connected")},onClose:a=>{console.log("[Manager Dashboard] WebSocket disconnected:",a.code,a.reason)},onError:a=>{console.error("[Manager Dashboard] WebSocket error:",a)}});r.useEffect(()=>{},[J,V]),r.useEffect(()=>{const a=()=>{G(window.innerWidth<768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),r.useEffect(()=>{N();const a=setInterval(()=>{N()},3e4);return()=>clearInterval(a)},[]);const K=k.currentSection;r.useEffect(()=>{n&&j()},[n,R]),r.useEffect(()=>{M.pathname==="/manager"&&u("/manager/applications",{replace:!0})},[M.pathname,u]);const N=async()=>{var a;try{const o=await w.notifications.getCount();(a=o.data)!=null&&a.success&&h(o.data.data.unread_count||0)}catch(o){console.error("Failed to fetch notification count:",o)}},j=async(a=!1)=>{var o,m;try{a?B(!0):E(!0),A(null),await Promise.all([Q(),X(),N()]),R>0&&S("Dashboard refreshed","Data has been updated successfully")}catch(c){console.error("Failed to fetch dashboard data:",c);const t=((m=(o=c.response)==null?void 0:o.data)==null?void 0:m.detail)||c.message||"Failed to load dashboard data";A(t),W("Failed to load dashboard",t)}finally{E(!1),B(!1)}},g=async a=>{a&&(I(a),setTimeout(()=>I(null),3e3)),await j(!0)},Q=async()=>{const a=await w.manager.getMyProperty();q(a.data||null)},X=async()=>{const a=await w.manager.getDashboardStats();F(a.data||{total_applications:0,pending_applications:0,approved_applications:0,total_employees:0,active_employees:0})},Y=()=>{U(a=>a+1)};if((n==null?void 0:n.role)!=="manager")return e.jsx("div",{className:"responsive-container padding-lg flex items-center justify-center min-h-screen",children:e.jsx(l,{className:"card-elevated card-rounded-lg max-w-md w-full",children:e.jsxs(d,{className:"card-padding-lg text-center spacing-sm",children:[e.jsx(P,{className:"h-12 w-12 text-amber-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-heading-lg text-primary mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-body-md text-secondary mb-6",children:"Manager role required to access this dashboard."}),e.jsx(v,{onClick:_,className:"",children:"Return to Login"})]})})});const Z=he.map(a=>({...a,badge:a.key==="applications"&&i&&i.pending_applications>0?i.pending_applications:void 0}));return e.jsx(xe,{children:e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"responsive-container padding-md",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4 mb-6",children:[e.jsxs("div",{className:"spacing-xs",children:[e.jsx("h1",{className:"text-display-md",children:"Manager Dashboard"}),e.jsxs("p",{className:"text-body-md text-secondary",children:["Welcome back, ",n.first_name," ",n.last_name]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[!1,L&&e.jsxs("div",{className:"flex items-center gap-2 animate-slide-in",children:[e.jsx(z,{className:"h-3 w-3 text-blue-500 animate-spin"}),e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:L})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{className:"notification-bell relative p-2 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>u("/manager/notifications"),title:"Notifications",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-600"}),f>0&&e.jsx(le,{className:"absolute -top-1 -right-1 h-5 w-5 p-0 flex items-center justify-center bg-red-500 text-white text-xs",children:f>99?"99+":f})]}),b&&e.jsxs(v,{onClick:Y,variant:"outline",size:"sm",className:"",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Retry"]}),e.jsx(v,{onClick:_,variant:"outline",className:"",children:"Logout"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(fe,{dashboard:"Manager",currentPage:K})}),b&&e.jsxs(oe,{variant:"destructive",className:"mb-6 animate-slide-down",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx(ne,{children:b})]}),e.jsx("div",{className:"mb-6",children:C?e.jsx(ge,{className:"h-32"}):s?e.jsxs(l,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:[e.jsx(ie,{className:"pb-3",children:e.jsxs(ce,{className:"text-xl font-semibold flex items-center gap-2 text-gray-900",children:[e.jsx(je,{className:"h-5 w-5 text-blue-600"}),s.name]})}),e.jsx(d,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Address"}),s.address||s.city||s.state||s.zip_code?e.jsxs("p",{className:"text-sm text-gray-600 leading-relaxed",children:[s.address||"",s.address?e.jsx("br",{}):null,[s.city,s.state].filter(Boolean).join(", "),(s.city||s.state)&&s.zip_code?` ${s.zip_code}`:s.zip_code||""]}):e.jsx("p",{className:"text-sm text-gray-400",children:"Not set"})]})]}),s.phone&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(we,{className:"h-4 w-4 text-gray-400 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Phone"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.phone})]})]})]})})]}):null}),e.jsx("div",{className:`mb-8 transition-opacity duration-300 ${T?"opacity-70":"opacity-100"}`,children:C?e.jsx(ue,{count:4}):i?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(l,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(d,{className:"p-6 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:i.total_applications}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Applications"})]})})}),e.jsx(l,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(d,{className:"p-6 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:i.pending_applications}),e.jsx("p",{className:"text-sm text-gray-500",children:"Pending Applications"})]})})}),e.jsx(l,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(d,{className:"p-6 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:i.approved_applications}),e.jsx("p",{className:"text-sm text-gray-500",children:"Approved Applications"})]})})}),e.jsx(l,{className:"shadow-sm border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:e.jsx(d,{className:"p-6 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:i.total_employees}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Employees"})]})})})]}):null}),e.jsx("div",{className:"mb-6",children:e.jsx(be,{items:Z,userRole:"manager",className:"w-full",variant:$?"mobile":"tabs",showLabels:!0,compact:!1,orientation:"horizontal",onNavigate:a=>{O(k.currentSection,a.key)}})}),e.jsx("div",{className:"spacing-md",children:e.jsx(se,{context:{stats:i,property:s,onStatsUpdate:j,userRole:"manager",propertyId:s==null?void 0:s.id,lastUpdateTime:H,isRefreshing:T}})})]})})})}export{Ue as ManagerDashboardLayout};
